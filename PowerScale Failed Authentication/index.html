<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Grant Curell" /><link rel="canonical" href="https://grantcurell.github.io/PowerScale%20Failed%20Authentication/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>PowerScale Failed Authentication - Grant Curell's Dell Projects</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "PowerScale Failed Authentication";
        var mkdocs_page_input_path = "PowerScale Failed Authentication/README.md";
        var mkdocs_page_url = "/PowerScale%20Failed%20Authentication/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Grant Curell's Dell Projects
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Grant Curell's Dell Projects</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Create Kickstart Server on Fedora/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Create OpenSwitch VM/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Dell Ansible Testing/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../DHCP Relay on SONiC/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Elasticsearch Display Map Data/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Elasticsearch Load Testing/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../esrally (INCOMPLETE)/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Estimating Compute Requirements for Machine Learning/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Finding Rare Logs with DBSCAN/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Get%20NVMe%20Drives%20from%20iDRAC%20Redfish/">Get NVMe Drives from iDRAC Redfish</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../High%20Speed%20Packet%20Capture/">High Speed Packet Capture</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../How%20Bitcoin-Blockchain%20Works%20-%20Notes/">How Bitcoin-Blockchain Works - Notes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../How%20OS10%20Installer%20Works/">How OS10 Installer Works</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../How%20to%20ONIE%20Install%20and%20ZTP%20Config%20Dell%20SONiC/">How to ONIE Install and ZTP Config Dell SONiC</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../How%20to%20Read%20lstopo%20and%20a%20PCIe%20Overview/">How to Read lstopo and a PCIe Overview</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../idrac%20with%20LDAP/">idrac with LDAP</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Importing%20Elasticsearch%20Data/">Importing Elasticsearch Data</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Installing%20DPDK%20with%20NapaTech%20Card/">Installing DPDK with NapaTech Card</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../IO%20Identities%20with%20LifeCycle%20Controller/">IO Identities with LifeCycle Controller</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../LDAP%20with%20OpenManage/">LDAP with OpenManage</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../LLMs%20Explained/">LLMs Explained</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Load%20Balance%20Testing%20on%204112F-ON/OpenSwitch%20%28OPX%29/">Load Balancing with LAG OPX</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Load%20Balance%20Testing%20on%204112F-ON/OS10/">Load Balance Testing on 4112F-ON w/OS10</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Load%20Balance%20Testing%20with%20OpenVSwitch/">Load Balance Testing with OpenVSwitch</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Load%20Balancing%20on%20Mellanox%20Switches/">Load Balancing on Mellanox Switches</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Load%20Balancing%20with%20LAG%20on%205112F-ON/">Load Balancing with LAG on 5112F-ON</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Migrating%20Storage%20Volumes%20to%20PowerStore/">Migrating Storage Volumes to PowerStore</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Mulitple%20Span%20on%204112F-ON%20with%20OpenSwitch/">Mulitple Span on 4112F-ON with OpenSwitch</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Multiple%20Span%20on%204112F-ON%20with%20OS10/">Multiple Span on 4112F-ON with OS10</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Notes%20on%20AMD%20Processor/">Notes on AMD Processor</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Notes%20on%20Building%20a%20Datacenter%20from%20Scratch/">Notes on Building a Datacenter from Scratch</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Notes%20on%20HPC/">Notes on HPC</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Notes%20on%20Improving%20Drive%20Performance/">Notes on Improving Drive Performance</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Notes%20on%20mdraid%20Performance%20Testing/">Notes on mdraid Performance Testing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Notes%20on%20nodejs/">Notes on nodejs</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Notes%20on%20NVMe%20Log%20Pages/">Notes on NVMe Log Pages</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Notes%20on%20PCIe/">Notes on PCIe</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Nvidia GPUDirect/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Nvidia%20GRID%20Notes/">Nvidia GRID Notes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../NVMe%20Performance%20Testing/">NVMe Performance Testing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Offline%20Updates%20with%20OpenManage%20Enterprise/">Offline Updates with OpenManage Enterprise</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Make%20USB%20Read%20Only/">Make USB Read Only</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Notes%20on%20HSM/">Notes on HSM</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../OME%20Bug/">OME Bug</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../OME%20Integration%20for%20VMWare/">OME Integration for VMWare</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../OpenFlow%20on%204112F-ON/">OpenFlow on 4112F-ON</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../OS10%20Password%20Recovery%20Bug/">OS10 Password Recovery Bug</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../PCIev3%20vs%20v4/">PCIev3 vs v4</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Playing%20with%20virsh/">Playing with virsh</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../PowerScale%20-%20Configure%20with%20Kubernetes/">PowerScale - Configure with Kubernetes</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">PowerScale Failed Authentication</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#problem-summary">Problem Summary</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#problem-details">Problem Details</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#expected-behavior">Expected Behavior</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#reproduction">Reproduction</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#demonstration">Demonstration</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#cluster-setup">Cluster Setup</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#rebuild">Rebuild</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#initial-setup">Initial Setup</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#code-for-testing-authentication-mechanisms">Code for Testing Authentication Mechanisms</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#concepts">Concepts</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#super-block-quorum">Super Block Quorum</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#how-do-session-teardowns-work">How Do Session Teardowns Work?</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../PowerScale%20Setup/">PowerScale Setup</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Reset%20OS10%20Admin%20Password/">Reset OS10 Admin Password</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Run%20VPN%20on%20OS10/">Run VPN on OS10</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Running DNS from OS10/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Set Up RSPAN on OS10/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Setting Up Breakout Cables/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Setting Up iDRAC Telemetry with Splunk/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Setting Up SmartFabric Director/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Setup IDPA/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Site to Site VPN with PFSense and CentOS 8/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../SONiC - Sample Datacenter Automation Architecture/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Switch Directly to Client Test/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Testing Bare Metal Orchestrator/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Testing Intel x520 on RHEL 6/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Understanding Memory/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Understanding PERC Interrupts/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Use OS10 as Aggregator/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Using FIO/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Using the iDRAC Service Module/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../VEP Testing/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../VMWare/Automate ESXi Installation/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../VMWare/ESXi Architecture/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../VMWare/Setup VXRail/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../VMWare/Troubleshooting vSAN/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../VMWare/VMWare APIs/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../VMWare/VxRail Architecture and Troubleshooting/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Web Traffic Generator/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Writing udev Rules for Dell PERC H755/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Adding Hashing to OpenSwitch/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Adding Intel I219-LM (8086.0d4c) Driver to ESXi/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Automatically Provision Dell Servers/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Automating OME Hardware Reports/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Backup OS10 Config with Ansible/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../CloudLink/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Common Questions About LLMs Answered/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Configure FN410 as a Switch/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Configure Gigamon Tap/README.md">None</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../Configuring VLT on OS10/README.md">None</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Grant Curell's Dell Projects</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">PowerScale Failed Authentication</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="powerscale-failed-authentication">PowerScale Failed Authentication</h1>
<ul>
<li><a href="#powerscale-failed-authentication">PowerScale Failed Authentication</a></li>
<li><a href="#problem-summary">Problem Summary</a></li>
<li><a href="#problem-details">Problem Details</a></li>
<li><a href="#expected-behavior">Expected Behavior</a></li>
<li><a href="#reproduction">Reproduction</a><ul>
<li><a href="#demonstration">Demonstration</a></li>
</ul>
</li>
<li><a href="#cluster-setup">Cluster Setup</a><ul>
<li><a href="#rebuild">Rebuild</a></li>
<li><a href="#initial-setup">Initial Setup</a></li>
</ul>
</li>
<li><a href="#code-for-testing-authentication-mechanisms">Code for Testing Authentication Mechanisms</a></li>
<li><a href="#concepts">Concepts</a><ul>
<li><a href="#super-block-quorum">Super Block Quorum</a></li>
<li><a href="#how-do-session-teardowns-work">How Do Session Teardowns Work?</a></li>
</ul>
</li>
</ul>
<h2 id="problem-summary">Problem Summary</h2>
<p>PowerScale OneOS inaccurately reports authentication failures when the number of concurrent sessions is exceeded.</p>
<h2 id="problem-details">Problem Details</h2>
<p>If <code>--concurrent-session-limit=LIMIT</code> is set with <code>isi auth settings global modify --concurrent-session-limit=15</code> and that limit is exceeded the logs will say:</p>
<p><strong>HTTP Error Log</strong></p>
<pre><code>tail -f /var/log/apache2/webui_httpd_error.log
2023-11-28T17:39:39.572651+00:00 &lt;18.3&gt; grantcluster-1(id1) httpd[98700]: [auth_isilon:error] [pid 98700:tid 34421640960] [client 172.16.5.155:62570] (STATUS_ACCESS_DENIED (0xC0000022) HTTP error: 401) Failed issuing a new JWT from the JWT service., referer: https://10.10.25.80:8080
2023-11-28T17:39:39.572673+00:00 &lt;18.3&gt; grantcluster-1(id1) httpd[98700]: [auth_isilon:error] [pid 98700:tid 34421640960] [client 172.16.5.155:62570] (401) Unable to create session., referer: https://10.10.25.80:8080
...SNIP...
2023-11-28T17:39:39.603718+00:00 &lt;18.3&gt; grantcluster-1(id1) httpd[98700]: [auth_isilon:error] [pid 98700:tid 34422848768] [client 172.16.5.155:62559] (STATUS_ACCESS_DENIED (0xC0000022) HTTP error: 401) Failed issuing a new JWT from the JWT service., referer: https://10.10.25.80:8080
2023-11-28T17:39:39.603728+00:00 &lt;18.3&gt; grantcluster-1(id1) httpd[98700]: [auth_isilon:error] [pid 98700:tid 34422848768] [client 172.16.5.155:62559] (401) Unable to create session., referer: https://10.10.25.80:8080
</code></pre>
<p><strong>HTTP Access Log</strong></p>
<pre><code>tail -f /var/log/apache2/webui_httpd_access.log
2023-11-28T17:41:43.101276+00:00 &lt;19.6&gt; grantcluster-1(id1) httpd[98697]: 172.16.5.155 - - [28/Nov/2023:17:41:43 +0000] &quot;POST /session/1/session HTTP/1.1&quot; 401 40 &quot;https://10.10.25.80:8080&quot; &quot;python-requests/2.28.1&quot;
</code></pre>
<p><strong>REST API Response</strong></p>
<pre><code>Total Successful Sessions: 0
Authentication Failed: Status Code 401, Error: Unable to create session.
</code></pre>
<p>While this is accurate, technically, it is extremely misleading and has lead to a substantial waste of resources investigating authentication failures when in reality the problem is that concurrent sessions was exceeded.</p>
<h2 id="expected-behavior">Expected Behavior</h2>
<p>The errors in <a href="#problem-details">Problem Details</a> are  misleading to both technicians and users. If the number of concurrent sessions is exceeded both the logs and the API responses should reflect that the issue is that the concurrent sessions have been exceeded instead of reporting an authentication error even if generating JWT tokens is the actual product of exceeding concurrent sessions.</p>
<p>The error message should make it so technicians resolve the problem without having to rely on developer support.</p>
<h2 id="reproduction">Reproduction</h2>
<p>The below <a href="https://github.com/grantcurell/grantcurell.github.io/blob/dev/docs/PowerScale%20Failed%20Authentication/multiple_sessions_test.py">Python script</a> will reproduce the problem. Replace the credentials with your PowerScale credentials and then run. It will generate 30 threads each of which will hold a session open for 10 seconds. If the number of concurrent sessions is below 30 it will fail.</p>
<pre><code class="language-python">import requests
import threading
import time
import urllib3

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)


def session_cookie_authentication(ip_address, username, password):
    &quot;&quot;&quot;
    Authenticate using Session Cookie and return the session cookies if successful.
    &quot;&quot;&quot;
    base_url = f&quot;https://{ip_address}:8080&quot;
    session_url = f&quot;{base_url}/session/1/session&quot;
    credentials = {&quot;username&quot;: username, &quot;password&quot;: password, &quot;services&quot;: [&quot;platform&quot;, &quot;namespace&quot;]}
    headers = {&quot;Content-Type&quot;: &quot;application/json&quot;, &quot;Referer&quot;: base_url}

    try:
        response = requests.post(session_url, headers=headers, json=credentials, verify=False)
        if response.status_code == 201 and 'isisessid' in response.cookies:
            return response.cookies
        else:
            error_message = response.json().get('message', 'No detailed error message provided.')
            return f&quot;Authentication Failed: Status Code {response.status_code}, Error: {error_message}&quot;
    except Exception as e:
        return f&quot;Error during Session Cookie Authentication: {e}&quot;


def create_and_hold_session(ip_address, username, password, hold_time, results):
    &quot;&quot;&quot;
    Create a session and hold it open for a specified duration.
    &quot;&quot;&quot;
    session_result = session_cookie_authentication(ip_address, username, password)
    if isinstance(session_result, requests.cookies.RequestsCookieJar):
        time.sleep(hold_time)  # Hold the session
        results.append(&quot;Session created and held successfully.&quot;)
    else:
        results.append(session_result)


def main():
    ip_address = &quot;10.10.25.80&quot;  # Replace with the actual IP address of the PowerScale
    username = &quot;root&quot;
    password = &quot;YOUR_PASSWORD&quot;
    hold_time = 10  # Hold time in seconds
    session_threads = []
    results = []

    # Create 30 concurrent sessions
    for _ in range(30):
        thread = threading.Thread(target=create_and_hold_session, args=(ip_address, username, password, hold_time, results))
        thread.start()
        session_threads.append(thread)

    # Wait for all threads to complete
    for thread in session_threads:
        thread.join()

    # Analyze results and print summary
    success_count = results.count(&quot;Session created and held successfully.&quot;)
    print(f&quot;Total Successful Sessions: {success_count}&quot;)
    error_messages = set([result for result in results if result != &quot;Session created and held successfully.&quot;])
    for error in error_messages:
        print(error)


if __name__ == &quot;__main__&quot;:
    main()

</code></pre>
<h3 id="demonstration">Demonstration</h3>
<p>Confirm concurrent sessions is fixed at 15:</p>
<pre><code>grantcluster-1# isi auth settings global view
                            Send NTLMv2: No
                      Space Replacement:
                              Workgroup: WORKGROUP
               Provider Hostname Lookup: disabled
                          Alloc Retries: 5
                 User Object Cache Size: 47.68M
                       On Disk Identity: native
                         RPC Block Time: Now
                       RPC Max Requests: 64
                            RPC Timeout: 30s
Default LDAP TLS Revocation Check Level: none
                   System GID Threshold: 80
                   System UID Threshold: 80
                         Min Mapped Rid: 2147483648
                              Group UID: 4294967292
                               Null GID: 4294967293
                               Null UID: 4294967293
                            Unknown GID: 4294967294
                            Unknown UID: 4294967294
                Failed Login Delay Time: Now
               Concurrent Session Limit: 15
</code></pre>
<p>Now we run the above Python script:</p>
<pre><code>C:\Users\grant\AppData\Local\Programs\Python\Python310\python.exe &quot;C:\Users\grant\Documents\code\grantcurell.github.io\docs\PowerScale Failed Authentication\multiple_sessions_test.py&quot; 
Total Successful Sessions: 0
Authentication Failed: Status Code 401, Error: Unable to create session.
</code></pre>
<p>Change the concurrent sessions to 31:</p>
<pre><code>grantcluster-1# isi auth settings global modify --concurrent-session-limit=31
grantcluster-1# isi auth settings global view
                            Send NTLMv2: No
                      Space Replacement:
                              Workgroup: WORKGROUP
               Provider Hostname Lookup: disabled
                          Alloc Retries: 5
                 User Object Cache Size: 47.68M
                       On Disk Identity: native
                         RPC Block Time: Now
                       RPC Max Requests: 64
                            RPC Timeout: 30s
Default LDAP TLS Revocation Check Level: none
                   System GID Threshold: 80
                   System UID Threshold: 80
                         Min Mapped Rid: 2147483648
                              Group UID: 4294967292
                               Null GID: 4294967293
                               Null UID: 4294967293
                            Unknown GID: 4294967294
                            Unknown UID: 4294967294
                Failed Login Delay Time: Now
               Concurrent Session Limit: 31

</code></pre>
<p>Rerun the script:</p>
<pre><code>C:\Users\grant\AppData\Local\Programs\Python\Python310\python.exe &quot;C:\Users\grant\Documents\code\grantcurell.github.io\docs\PowerScale Failed Authentication\multiple_sessions_test.py&quot; 
Total Successful Sessions: 30

Process finished with exit code 0
</code></pre>
<h2 id="cluster-setup">Cluster Setup</h2>
<h3 id="rebuild">Rebuild</h3>
<p>I hopped on an old cluster I used for testing and ran <code>isi_reformat_node</code></p>
<h3 id="initial-setup">Initial Setup</h3>
<p>These are the settings I used for my build. Since I was building this in a lab I told it to use the internal IP addresses for external as well instead of making them separate sets.</p>
<table>
<thead>
<tr>
<th>Configuration Item</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cluster name</td>
<td>grantcluster</td>
</tr>
<tr>
<td>Encoding</td>
<td>utf-8</td>
</tr>
<tr>
<td>int-a netmask</td>
<td>255.255.255.0</td>
</tr>
<tr>
<td>int-a IP ranges</td>
<td>{ 10.10.25.80-10.10.25.89 }</td>
</tr>
<tr>
<td>int-a IP range</td>
<td>{ 10.10.25.80-10.10.25.89 }</td>
</tr>
<tr>
<td>int-a gateway</td>
<td>10.10.25.1</td>
</tr>
<tr>
<td>SmartConnect zone name</td>
<td>onefs</td>
</tr>
<tr>
<td>DNS servers</td>
<td>{ 10.10.25.120 }</td>
</tr>
<tr>
<td>Search domains</td>
<td>{ grant.lan, lan }</td>
</tr>
</tbody>
</table>
<p>After I joined the nodes together I confirmed they had a quorum:</p>
<pre><code class="language-bash">grantcluster-1# sysctl efs.gmp.has_quorum
efs.gmp.has_quorum: 1
grantcluster-1# sysctl efs.gmp.has_super_block_quorum
efs.gmp.has_super_block_quorum: 1
</code></pre>
<p>1 indicates success whereas 0 indicates that there is no quorum. Super Blocks are described <a href="#super-block-quorum">here</a>.</p>
<h2 id="code-for-testing-authentication-mechanisms">Code for Testing Authentication Mechanisms</h2>
<p>I used <a href="https://github.com/grantcurell/grantcurell.github.io/blob/dev/docs/PowerScale%20Failed%20Authentication/authentication_test.py">this code</a> to test the different authentication mechanisms to confirm valid credentials.</p>
<h2 id="concepts">Concepts</h2>
<h3 id="super-block-quorum">Super Block Quorum</h3>
<p>Referred to as <code>efs.gmp.has_super_block_quorum</code>, is a property that ensures the file system's integrity by requiring more than half of the nodes in the cluster to be available and in agreement over the internal network. This quorum prevents data conflicts, such as conflicting versions of the same file if two groups of nodes become unsynchronized. If a node is unreachable, OneFS will separate it from the cluster, known as splitting. Operations can continue as long as a quorum of nodes remains connected. If the split nodes can reconnect and re-synchronize, they rejoin the majority group in a process known as merging. The superblock quorum status can be checked by connecting to a node via SSH and running the <code>sysctl efs.gmp.has_super_block_quorum</code> command-line tool as root.</p>
<h3 id="how-do-session-teardowns-work">How Do Session Teardowns Work?</h3>
<p>See <a href="session_teardown_reverse_engineering/">Session Teardown Reverse Engineering</a></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../PowerScale%20-%20Configure%20with%20Kubernetes/" class="btn btn-neutral float-left" title="PowerScale - Configure with Kubernetes"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../PowerScale%20Setup/" class="btn btn-neutral float-right" title="PowerScale Setup">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../PowerScale%20-%20Configure%20with%20Kubernetes/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../PowerScale%20Setup/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
