<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Notes on vSAN - Grant Curell's Dell Projects</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Notes on vSAN";
    var mkdocs_page_input_path = "VMWare/Notes on vSAN/README.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Grant Curell's Dell Projects</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Grant Curell's Dell Projects</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Adding%20Hashing%20to%20OpenSwitch/">Adding Hashing to OpenSwitch</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Adding%20Intel%20I219-LM%20%288086.0d4c%29%20Driver%20to%20ESXi/">Adding Intel I219-LM (8086.0d4c) Driver to ESXi</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Automating%20OME%20Hardware%20Reports/">Automating OME Hardware Reports</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../CloudLink/">CloudLink</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Configure%20FN410%20as%20a%20Switch/">Configure FN410 as a Switch</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Configure%20Gigamon%20Tap/">Configure Gigamon Tap</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Configuring%20VLT%20on%20OS10/">Configuring VLT on OS10</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Create%20Kickstart%20Server%20on%20Fedora/">Create Kickstart Server on Fedora</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Create%20OpenSwitch%20VM/">Create OpenSwitch VM</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Dell%20Ansible%20Testing/">Dell Ansible Testing</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../DHCP%20Relay%20on%20SONiC/">DHCP Relay on SONiC</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Elasticsearch%20Display%20Map%20Data/">Elasticsearch Display Map Data</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Elasticsearch%20Load%20Testing/">Elasticsearch Load Testing</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../esrally%20%28INCOMPLETE%29/">esrally (INCOMPLETE)</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../High%20Speed%20Packet%20Capture/">High Speed Packet Capture</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../How%20OS10%20Installer%20Works/">How OS10 Installer Works</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../idrac%20with%20LDAP/">idrac with LDAP</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Importing%20Elasticsearch%20Data/">Importing Elasticsearch Data</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Installing%20DPDK%20with%20NapaTech%20Card/">Installing DPDK with NapaTech Card</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../IO%20Identities%20with%20LifeCycle%20Controller/">IO Identities with LifeCycle Controller</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../LDAP%20with%20OpenManage/">LDAP with OpenManage</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Load%20Balance%20Testing%20on%204112F-ON/OpenSwitch%20%28OPX%29/">Load Balancing with LAG OPX</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Load%20Balance%20Testing%20on%204112F-ON/OS10/">Load Balance Testing on 4112F-ON w/OS10</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Load%20Balance%20Testing%20with%20OpenVSwitch/">Load Balance Testing with OpenVSwitch</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Load%20Balancing%20on%20Mellanox%20Switches/">Load Balancing on Mellanox Switches</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Load%20Balancing%20with%20LAG%20on%205112F-ON/">Load Balancing with LAG on 5112F-ON</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Mulitple%20Span%20on%204112F-ON%20with%20OpenSwitch/">Mulitple Span on 4112F-ON with OpenSwitch</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Multiple%20Span%20on%204112F-ON%20with%20OS10/">Multiple Span on 4112F-ON with OS10</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Nvidia%20GPUDirect/">Nvidia GPUDirect</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../NVMe%20Performance%20Testing/">NVMe Performance Testing</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Offline%20Updates%20with%20OpenManage%20Enterprise/">Offline Updates with OpenManage Enterprise</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../OME%20Bug/">OME Bug</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../OME%20Integration%20for%20VMWare/">OME Integration for VMWare</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../OpenFlow%20on%204112F-ON/">OpenFlow on 4112F-ON</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../OS10%20Password%20Recovery%20Bug/">OS10 Password Recovery Bug</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../PCIev3%20vs%20v4/">PCIev3 vs v4</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Playing%20with%20virsh/">Playing with virsh</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Reset%20OS10%20Admin%20Password/">Reset OS10 Admin Password</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Run%20VPN%20on%20OS10/">Run VPN on OS10</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Running%20DNS%20from%20OS10/">Running DNS from OS10</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Set%20Up%20RSPAN%20on%20OS10/">Set Up RSPAN on OS10</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Setting%20Up%20Breakout%20Cables/">Setting Up Breakout Cables</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Setting%20Up%20SmartFabric%20Director/">Setting Up SmartFabric Director</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Setup%20IDPA/">Setup IDPA</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Site%20to%20Site%20VPN%20with%20PFSense%20and%20CentOS%208/">Site to Site VPN with PFSense and CentOS 8</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../SONiC%20-%20Fully%20Automated%20Build/">SONiC - Fully Automated Build</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Switch%20Directly%20to%20Client%20Test/">Switch Directly to Client Test</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Testing%20Intel%20x520%20on%20RHEL%206/">Testing Intel x520 on RHEL 6</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Understanding%20Memory/">Understanding Memory</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Use%20OS10%20as%20Aggregator/">Use OS10 as Aggregator</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../VEP%20Testing/">VEP Testing</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Automate%20ESXi%20Installation/">Automating ESXi Installation</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../ESXi%20Architecture/">VMWare Architecture Notes</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Notes on vSAN</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#disk-groups">Disk Groups</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#deduplication-and-replication">Deduplication and Replication</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#what-is-a-replica-other-source">What is a Replica (other source)</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#distributed-datastore">Distributed Datastore</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#objects-and-components">Objects and Components</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#raid-architecture">RAID Architecture</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#required-networks">Required Networks</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#quarum-logic">Quarum Logic</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#fault-domains">Fault Domains</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#sample-architecture">Sample Architecture</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#witness">Witness</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#alternate-explanation-includes-stripes">Alternate Explanation (includes stripes)</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#design-notes">Design Notes</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#networking">Networking</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#erasure-coding">Erasure Coding</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#raid-5">RAID 5</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#raid-6">RAID 6</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#internal-components">Internal Components</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vsan-layers">vSAN Layers</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#objects-and-components_1">Objects and Components</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#another-explanation">Another explanation</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vsan-networking-roles">vSAN Networking Roles</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vsan-raid-tree">vSAN RAID Tree</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#other-notes">Other Notes</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#minimum-drive-requirements">Minimum Drive Requirements</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#minimum-hosts-for-vsan">Minimum Hosts for vSAN</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#minimum-hosts-for-erasure-coding-raid56">Minimum Hosts for Erasure Coding (RAID5/6)</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#maximum-size">Maximum Size</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#deduplication-and-compression">Deduplication and Compression</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Setup%20VXRail/">VxRail Setup</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Troubleshooting%20vSAN/">Troubleshooting vSAN</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../VMWare%20APIs/">VMWare APIs</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../VxRail%20Architecture%20and%20Troubleshooting/">VxRail Architecture and Troubleshooting</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Web%20Traffic%20Generator/">Web Traffic Generator</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Grant Curell's Dell Projects</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>Notes on vSAN</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="notes-on-vsan">Notes on vSAN</h1>
<ul>
<li><a href="#notes-on-vsan">Notes on vSAN</a></li>
<li><a href="#disk-groups">Disk Groups</a></li>
<li><a href="#deduplication-and-replication">Deduplication and Replication</a><ul>
<li><a href="#what-is-a-replica-other-source">What is a Replica (other source)</a></li>
</ul>
</li>
<li><a href="#distributed-datastore">Distributed Datastore</a></li>
<li><a href="#objects-and-components">Objects and Components</a></li>
<li><a href="#raid-architecture">RAID Architecture</a></li>
<li><a href="#required-networks">Required Networks</a></li>
<li><a href="#quarum-logic">Quarum Logic</a><ul>
<li><a href="#fault-domains">Fault Domains</a></li>
<li><a href="#sample-architecture">Sample Architecture</a></li>
</ul>
</li>
<li><a href="#witness">Witness</a><ul>
<li><a href="#alternate-explanation-includes-stripes">Alternate Explanation (includes stripes)</a></li>
</ul>
</li>
<li><a href="#design-notes">Design Notes</a><ul>
<li><a href="#networking">Networking</a></li>
<li><a href="#erasure-coding">Erasure Coding</a></li>
<li><a href="#raid-5">RAID 5</a></li>
<li><a href="#raid-6">RAID 6</a></li>
<li><a href="#internal-components">Internal Components</a></li>
</ul>
</li>
<li><a href="#vsan-layers">vSAN Layers</a></li>
<li><a href="#objects-and-components-1">Objects and Components</a><ul>
<li><a href="#another-explanation">Another explanation</a></li>
</ul>
</li>
<li><a href="#vsan-networking-roles">vSAN Networking Roles</a></li>
<li><a href="#vsan-raid-tree">vSAN RAID Tree</a></li>
<li><a href="#other-notes">Other Notes</a><ul>
<li><a href="#minimum-drive-requirements">Minimum Drive Requirements</a></li>
<li><a href="#minimum-hosts-for-vsan">Minimum Hosts for vSAN</a></li>
<li><a href="#minimum-hosts-for-erasure-coding-raid56">Minimum Hosts for Erasure Coding (RAID5/6)</a></li>
<li><a href="#maximum-size">Maximum Size</a></li>
<li><a href="#deduplication-and-compression">Deduplication and Compression</a></li>
</ul>
</li>
</ul>
<h2 id="disk-groups">Disk Groups</h2>
<p><img alt="" src="images/2021-07-12-13-18-23.png" /></p>
<p><img alt="" src="images/2021-07-12-13-36-00.png" /></p>
<p><img alt="" src="images/2021-07-12-13-38-00.png" /></p>
<h2 id="deduplication-and-replication">Deduplication and Replication</h2>
<ul>
<li>The scope of deduplication and compression exists only within each disk group.</li>
<li>Hosken, Martin. VMware Software-Defined Storage (Kindle Locations 5278-5279). Wiley. Kindle Edition. </li>
</ul>
<p><img alt="" src="images/2021-07-12-13-41-03.png" /></p>
<ul>
<li>Virtual SAN uses a distributed read cache mechanism whereby reads and writes are distributed to all hosts holding replicas. This way, if one host is busy, the other hosts holding replicas can still service I/ O requests.</li>
<li>
<p>Hosken, Martin. VMware Software-Defined Storage (Kindle Locations 5317-5318). Wiley. Kindle Edition. </p>
</li>
<li>
<p>Virtual SAN locates data in two or more locations across the distributed Virtual SAN datastore, in order to withstand host or disk failures. With data locality operating in this way, I/ O can come from any of the data replicas across the cluster, helping to mitigate potential host or disk bottlenecks and allowing Virtual SAN to run more efficiently, while still maintaining data availability and optimum performance.</p>
</li>
<li>
<p>Hosken, Martin. VMware Software-Defined Storage (Kindle Locations 5324-5327). Wiley. Kindle Edition. </p>
</li>
<li>
<p>The mechanism for destaging differs between the two Virtual SAN models, hybrid and all-flash; mechanical disks are typically good at handling sequential write workloads, so Virtual SAN uses this to make the process more efficient. In the hybrid model, an elevator algorithm runs independently on each disk group and decides, locally, whether to move any data to its capacity disks, and if so, when. This algorithm uses multiple criteria and batches together larger chunks of data that are physically proximal on a mechanical disk, and destages them together asynchronously. This mechanism writes to the disk sequentially for improved performance. However, the destaging mechanism is also conservative: it will not rush to move data if the space in the write buffer is not constringed. In addition, as data that is written tends to be overwritten quickly within a short period of time, this approach avoids writing the same blocks of data multiple times to the mechanical disks. Also note that the write buffers of the capacity layer disks are flushed onto the persistent storage devices before writes are discarded from the caching device. In the all-flash model, Virtual SAN uses 100 percent of the available capacity on the endurance flash device as a write buffer. In all-flash configurations, essentially the same mechanism is in place as that in the hybrid model. However, Virtual SAN does not take into account the proximal algorithm, making it a more efficient mechanism for destaging to capacity flash devices. Also, in the all-flash model, changes to the elevator algorithm allow the destaging of cold data from the write cache to the capacity tier, based on their data blocks' relative hotness or coldness. In addition, data blocks that are overwritten stay in the caching tier longer, which results in reducing the overall wear on the capacity tier flash devices, increasing their life expectancy.</p>
</li>
<li>Hosken, Martin. VMware Software-Defined Storage (Kindle Locations 5339-5353). Wiley. Kindle Edition.</li>
</ul>
<h3 id="what-is-a-replica-other-source">What is a Replica (other source)</h3>
<p><img alt="" src="images/2021-08-30-09-19-07.png" /></p>
<h2 id="distributed-datastore">Distributed Datastore</h2>
<p><img alt="" src="images/2021-07-12-14-51-59.png" /></p>
<h2 id="objects-and-components">Objects and Components</h2>
<p><img alt="" src="images/2021-07-12-14-56-54.png" /></p>
<h2 id="raid-architecture">RAID Architecture</h2>
<p><img alt="" src="images/2021-07-12-14-57-21.png" /></p>
<h2 id="required-networks">Required Networks</h2>
<p><img alt="" src="images/2021-07-12-15-03-21.png" /></p>
<h2 id="quarum-logic">Quarum Logic</h2>
<ul>
<li>A Virtual SAN– enabled cluster uses a quorum-based system with witness components to ensure consistent operations across the distributed datastore. The quorum is the minimum number of votes that a distributed system must be able to obtain, in order to be allowed to perform an operation. In Virtual SAN, 50 percent of the votes that make up a virtual machine's storage object must be accessible at all times for that replica to be active. If less than 50 percent of the votes are accessible to the host, the object is not available and is marked as inaccessible in the Virtual SAN datastore. This can become a problem for Virtual SAN that can affect the availability of virtual machines, if after a host failure, the loss of quorum for a virtual machine object results in vSphere High Availability not being able to restart the virtual machine until the cluster quorum is restored. vSphere HA can guarantee that a virtual machine will restart only when it has a cluster quorum and can access the most recent copy of the virtual machine object. For instance, Figure 4.48 shows a three-node cluster that has a single virtual machine running on host 1, which has been assigned a storage policy with an FTT (Failures to Tolerate) of 1. If all three hosts fail in sequence (with host 3 the last host to fail), when host 1 and host 2 come back online, vSphere HA will be unable to restart the virtual machine because the last host that failed, host 3, retains the most recent copy of the virtual machine object components and is currently inaccessible. In this scenario, either all three hosts must recover at the same time or the two-host quorum must include host 3. If neither of these conditions is satisfied, vSphere High Availability will attempt to restart the virtual machine again when host 3 comes back online.</li>
<li>Hosken, Martin. VMware Software-Defined Storage (p. 302). Wiley. Kindle Edition. </li>
</ul>
<p><img alt="" src="images/2021-07-12-15-19-05.png" /></p>
<h3 id="fault-domains">Fault Domains</h3>
<p><img alt="" src="images/2021-07-12-15-24-26.png" />
<img alt="" src="images/2021-07-12-15-24-49.png" /></p>
<h4 id="sample-architecture">Sample Architecture</h4>
<p><img alt="" src="images/2021-07-12-15-26-20.png" />
<img alt="" src="images/2021-07-12-15-26-40.png" /></p>
<h2 id="witness">Witness</h2>
<ul>
<li>Witnesses are zero-length components, containing just metadata. The purpose of the witness is to ensure that only one network partition can access an object at any one time. For instance, consider a failure scenario in which two vSphere hosts communicate over a Virtual SAN network. The VMDK object has been configured with a replica, so there is a copy of the VMDK on a second vSphere host. If the Virtual SAN network goes down, the two hosts are no longer able to communicate with one another, even though both hosts are still up and running and accessing other networks successfully. From which partition does the virtual machine access the data?</li>
<li>Hosken, Martin. VMware Software-Defined Storage (p. 211). Wiley. Kindle Edition. </li>
</ul>
<p><img alt="" src="images/2021-07-12-14-59-11.png" /></p>
<p>The logic for the equation 2n+1 comes from the fact that you have to have replicas on two different hosts and then a third to act as a tie breaker with the witness.</p>
<p><img alt="" src="images/2021-08-30-21-12-51.png" /></p>
<h3 id="alternate-explanation-includes-stripes">Alternate Explanation (includes stripes)</h3>
<p><img alt="" src="images/2021-08-30-09-21-03.png" />
<img alt="" src="images/2021-08-30-09-21-37.png" /></p>
<h2 id="design-notes">Design Notes</h2>
<h3 id="networking">Networking</h3>
<p><img alt="" src="images/2021-07-12-15-04-47.png" /></p>
<ul>
<li>Comparing the vSphere Standard and Distributed Virtual Switches When designing the virtual switch configuration, if not already dictated by other design factors, one required design decision may be whether to adopt the vSphere standard switch or to implement the vSphere Distributed Switch (VDS), with Virtual SAN deployment being supported on both options. The major benefit of the vSphere standard switch is simplicity of implementation. However, as the Virtual SAN environment grows, the design might benefit from several features offered only by the VDS, including Network I/ O Control (NIOC), Link Aggregation Control Protocol (LACP), and NetFlow. Another key consideration that factors into this design decision is whether VMware NSX is included in the overall environment architecture. One of the key benefits of using the vSphere Distributed Switch in a Virtual SAN environment is that NIOC can be used, which allows for the prioritization of bandwidth when there is network contention. For instance, replication and synchronization activities that Virtual SAN will impose on the network can cause contention. Depending on the number of virtual machines, their level of network activity, and Virtual SAN network utilization, 1 Gb/ s networks can easily be saturated and overwhelmed, particularly during rebuild and synchronization operations. Through the use of NIOC and QoS, vSphere</li>
<li>Hosken, Martin. VMware Software-Defined Storage (p. 238). Wiley. Kindle Edition. </li>
</ul>
<h3 id="erasure-coding">Erasure Coding</h3>
<p>How it works: https://stonefly.com/blog/understanding-erasure-coding
<img alt="" src="images/2021-07-12-15-11-54.png" /></p>
<h4 id="raid-5">RAID 5</h4>
<p><img alt="" src="images/2021-07-12-15-13-04.png" /></p>
<h4 id="raid-6">RAID 6</h4>
<p><img alt="" src="images/2021-07-12-15-14-32.png" /></p>
<h3 id="internal-components">Internal Components</h3>
<p><img alt="" src="images/2021-07-12-15-27-38.png" />
<img alt="" src="images/2021-07-12-15-28-32.png" />
<img alt="" src="images/2021-08-30-09-15-33.png" />
<img alt="" src="images/2021-08-30-09-15-56.png" /></p>
<h2 id="vsan-layers">vSAN Layers</h2>
<p><img alt="" src="images/2021-08-29-20-51-40.png" />
<img alt="" src="images/2021-08-29-21-23-36.png" />
<img alt="" src="images/2021-08-29-21-23-50.png" /></p>
<h2 id="objects-and-components_1">Objects and Components</h2>
<p>See https://masteringvmware.com/vsan-objects-and-components/</p>
<p>Component is an single file which you can say it as single VMDK. When you apply an storage policy to the Virtual Machine based on the policy components gets created and replicated. Let’s take an Example where you have created a VM with RAID-1 (Mirroring). So now when you see at the VM placement you will see that different components gets created. Component has the maximum limit of 255GB. So that means if your VMDK is more then 255 GB in size then it will be striped and if the VMDK is less then 255GB in size then it will be single component. In vSAN 6.6 there is limit of maximum 9000 components per vSAN Host. vSAN Distributes the components across the hosts evenly for the availability and to maintain the balance.</p>
<p><img alt="" src="images/2021-08-30-09-18-03.png" /></p>
<h3 id="another-explanation">Another explanation</h3>
<p>This also describes stripe width</p>
<p><img alt="" src="images/2021-12-15-10-52-27.png" />
<img alt="" src="images/2021-12-15-10-52-38.png" />
<img alt="" src="images/2021-12-15-10-53-07.png" /></p>
<h2 id="vsan-networking-roles">vSAN Networking Roles</h2>
<p><img alt="" src="images/2021-08-30-18-26-21.png" />
CMMDS = Clustered metadata database and monitoring service
Multicast addresses used are as follows:
<img alt="" src="images/2021-08-30-18-32-16.png" /></p>
<h2 id="vsan-raid-tree">vSAN RAID Tree</h2>
<p><img alt="" src="images/2021-08-30-21-11-26.png" />
<img alt="" src="images/2021-08-30-21-13-28.png" /></p>
<h2 id="other-notes">Other Notes</h2>
<h3 id="minimum-drive-requirements">Minimum Drive Requirements</h3>
<p>Each host contributing storage capacity to the vSAN cluster will require at least one flash device and one capacity device (magnetic disk or flash). Note that the capacity tier is either all-flash or all magnetic disk; they cannot be mixed in the same vSAN cluster.</p>
<p>Hogan, Cormac; Epping, Duncan. VMware vSAN 6.7 U1 Deep Dive . Kindle Edition. </p>
<h3 id="minimum-hosts-for-vsan">Minimum Hosts for vSAN</h3>
<p>At a minimum, vSAN requires three hosts in your cluster to contribute storage (or two hosts if you decide to use a witness host, which is a common configuration for ROBO, this is discussed in chapter 8); other hosts in your cluster could leverage these storage resources without contributing storage resources to the cluster itself, although this is not common.</p>
<p>Hogan, Cormac; Epping, Duncan. VMware vSAN 6.7 U1 Deep Dive . Kindle Edition. </p>
<h3 id="minimum-hosts-for-erasure-coding-raid56">Minimum Hosts for Erasure Coding (RAID5/6)</h3>
<p><img alt="" src="images/2021-12-15-10-50-33.png" /></p>
<h3 id="maximum-size">Maximum Size</h3>
<p>Today’s boundary for vSAN in terms of both size and connectivity is a vSphere cluster. This means that vSAN supports single clusters/datastores of up to 64 hosts, but of course a single vCenter Server instance can manage many 64 host clusters. It is a common practice for most customers however to limit their clusters to around 20 hosts. This is for operational considerations like the time it takes to update a full cluster. Each host can run a supported maximum of 200 VMs, up to a total of 6,400 VMs within a 64-host vSAN cluster.</p>
<p>Hogan, Cormac; Epping, Duncan. VMware vSAN 6.7 U1 Deep Dive . Kindle Edition. </p>
<h3 id="deduplication-and-compression">Deduplication and Compression</h3>
<p>When creating your vSAN cluster, if your vSAN cluster is an all-flash configuration, you have the option to enable “deduplication and compression.” Deduplication and compression will play a big factor in available capacity for an all-flash configuration. Note that these data services are not available in a hybrid configuration.</p>
<p>Hogan, Cormac; Epping, Duncan. VMware vSAN 6.7 U1 Deep Dive . Kindle Edition. </p>
<p>But it is not just deduplication and compression that can provide space saving on the vSAN datastore. There is also the number of replica copies configured if the VM is using a RAID-1 policy. This is enabled through the policy-based management framework. Conversely, you may decide to use erasure coding polices such as RAID-5 and RAID-6 (but note that this space efficiency feature is only available on all-flash vSAN). These all determine how many VMs can be deployed on the datastore.</p>
<p>Hogan, Cormac; Epping, Duncan. VMware vSAN 6.7 U1 Deep Dive . Kindle Edition. </p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Setup%20VXRail/" class="btn btn-neutral float-right" title="VxRail Setup">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../ESXi%20Architecture/" class="btn btn-neutral" title="VMWare Architecture Notes"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../ESXi%20Architecture/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../Setup%20VXRail/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
