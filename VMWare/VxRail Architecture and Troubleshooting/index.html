<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>VxRail Architecture and Troubleshooting - Grant Curell's Dell Projects</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "VxRail Architecture and Troubleshooting";
    var mkdocs_page_input_path = "VMWare/VxRail Architecture and Troubleshooting/README.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Grant Curell's Dell Projects</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Grant Curell's Dell Projects</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Adding%20Hashing%20to%20OpenSwitch/">Adding Hashing to OpenSwitch</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Adding%20Intel%20I219-LM%20%288086.0d4c%29%20Driver%20to%20ESXi/">Adding Intel I219-LM (8086.0d4c) Driver to ESXi</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Automating%20OME%20Hardware%20Reports/">Automating OME Hardware Reports</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../CloudLink/">CloudLink</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Configure%20FN410%20as%20a%20Switch/">Configure FN410 as a Switch</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Configure%20Gigamon%20Tap/">Configure Gigamon Tap</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Configuring%20VLT%20on%20OS10/">Configuring VLT on OS10</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Create%20Kickstart%20Server%20on%20Fedora/">Create Kickstart Server on Fedora</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Create%20OpenSwitch%20VM/">Create OpenSwitch VM</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Dell%20Ansible%20Testing/">Dell Ansible Testing</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../DHCP%20Relay%20on%20SONiC/">DHCP Relay on SONiC</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Elasticsearch%20Display%20Map%20Data/">Elasticsearch Display Map Data</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Elasticsearch%20Load%20Testing/">Elasticsearch Load Testing</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../esrally%20%28INCOMPLETE%29/">esrally (INCOMPLETE)</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../High%20Speed%20Packet%20Capture/">High Speed Packet Capture</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../How%20OS10%20Installer%20Works/">How OS10 Installer Works</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../idrac%20with%20LDAP/">idrac with LDAP</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Importing%20Elasticsearch%20Data/">Importing Elasticsearch Data</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Installing%20DPDK%20with%20NapaTech%20Card/">Installing DPDK with NapaTech Card</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../IO%20Identities%20with%20LifeCycle%20Controller/">IO Identities with LifeCycle Controller</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../LDAP%20with%20OpenManage/">LDAP with OpenManage</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Load%20Balance%20Testing%20on%204112F-ON/OpenSwitch%20%28OPX%29/">Load Balancing with LAG OPX</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Load%20Balance%20Testing%20on%204112F-ON/OS10/">Load Balance Testing on 4112F-ON w/OS10</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Load%20Balance%20Testing%20with%20OpenVSwitch/">Load Balance Testing with OpenVSwitch</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Load%20Balancing%20on%20Mellanox%20Switches/">Load Balancing on Mellanox Switches</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Load%20Balancing%20with%20LAG%20on%205112F-ON/">Load Balancing with LAG on 5112F-ON</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Mulitple%20Span%20on%204112F-ON%20with%20OpenSwitch/">Mulitple Span on 4112F-ON with OpenSwitch</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Multiple%20Span%20on%204112F-ON%20with%20OS10/">Multiple Span on 4112F-ON with OS10</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Nvidia%20GPUDirect/">Nvidia GPUDirect</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../NVMe%20Performance%20Testing/">NVMe Performance Testing</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Offline%20Updates%20with%20OpenManage%20Enterprise/">Offline Updates with OpenManage Enterprise</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../OME%20Bug/">OME Bug</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../OME%20Integration%20for%20VMWare/">OME Integration for VMWare</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../OpenFlow%20on%204112F-ON/">Create OpenFlow Load Balancer</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../OS10%20Password%20Recovery%20Bug/">OS10 Password Recovery Bug</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../PCIev3%20vs%20v4/">PCIev3 vs v4</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Playing%20with%20virsh/">Playing with virsh</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Reset%20OS10%20Admin%20Password/">Reset OS10 Admin Password</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Run%20VPN%20on%20OS10/">Run VPN on OS10</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Running%20DNS%20from%20OS10/">Running DNS from OS10</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Set%20Up%20RSPAN%20on%20OS10/">Set Up RSPAN on OS10</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Setting%20Up%20Breakout%20Cables/">Setting Up Breakout Cables</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Setting%20Up%20SmartFabric%20Director/">Setting Up SmartFabric Director</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Setup%20IDPA/">Setup IDPA</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Site%20to%20Site%20VPN%20with%20PFSense%20and%20CentOS%208/">Site to Site VPN with PFSense and CentOS 8</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../SONiC%20-%20Fully%20Automated%20Build/">SONiC - Fully Automated Build</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Switch%20Directly%20to%20Client%20Test/">Switch Directly to Client Test</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Testing%20Intel%20x520%20on%20RHEL%206/">Testing Intel x520 on RHEL 6</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Understanding%20Memory/">Understanding Memory</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Use%20OS10%20as%20Aggregator/">Use OS10 as Aggregator</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../VEP%20Testing/">VEP Testing</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Automate%20ESXi%20Installation/">Automating ESXi Installation</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../ESXi%20Architecture/">VMWare Architecture Notes</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../ESXi%20Downloads%20Missing/">ESXi Downloads Missing</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Notes%20on%20vSAN/">Notes on vSAN</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Setup%20VXRail/">VxRail Setup</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Troubleshooting%20vSAN/">Troubleshooting vSAN</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../VMWare%20APIs/">VMWare APIs</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">VxRail Architecture and Troubleshooting</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#vxrail-architecture">VxRail Architecture</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#vxrail-mystic-lcm-70202rpm">vxrail-mystic-lcm-7.0.202.rpm</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#vxrail-systemzip">vxrail-system.zip</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#vxrail_70200-17911444zip">VXRAIL_7.0.200-17911444.zip</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#inspecting-vib-files">Inspecting VIB files</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#inspecting-java-class-files">Inspecting Java Class Files</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#upgrades">Upgrades</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#how-upgrades-work">How Upgrades Work</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#failed-upgrade">Failed Upgrade</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#observed-errors">Observed Errors</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#fix-action">Fix Action</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#understanding-upgrades-in-esxi">Understanding Upgrades in ESXi</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#understanding-the-vxrail-update-bundle">Understanding the VxRail Update Bundle</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#manifest-file-and-update-order">Manifest File and Update Order</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#adding-nodes">Adding Nodes</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#troubleshooting">Troubleshooting</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#how-adding-nodes-works-during-cluster-construction">How Adding Nodes Works During Cluster Construction</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#disappearing-browse-button">Disappearing Browse Button</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#log-info">Log Info</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixing-half-upgrade">Fixing Half Upgrade</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vcenter-logs">vCenter Logs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#altbootbank">Altbootbank</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#add-nodes-nic-config-page">Add nodes NIC config page</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#add-node-error">Add Node Error</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#error-node">Error Node</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#general-error">General Error</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#redeploying-vxrail-manager">Redeploying VxRail Manager</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#logs">Logs</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#generating-logs">Generating Logs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#vxrail-microservice-container-logs">VxRail Microservice (container) Logs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#rasr-process">RASR Process</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#tomcat-logs">Tomcat Logs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#upgrade-logs">Upgrade Logs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#api-logs">API Logs</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#helpful-commands">Helpful Commands</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#helpful-kb-articles">Helpful KB Articles</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vxrail-api-info">VxRail API Info</a>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Web%20Traffic%20Generator/">Web Traffic Generator</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Grant Curell's Dell Projects</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>VxRail Architecture and Troubleshooting</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="vxrail-architecture-and-troubleshooting">VxRail Architecture and Troubleshooting</h1>
<ul>
<li><a href="#vxrail-architecture-and-troubleshooting">VxRail Architecture and Troubleshooting</a></li>
<li><a href="#vxrail-architecture">VxRail Architecture</a><ul>
<li><a href="#vxrail-mystic-lcm-70202rpm">vxrail-mystic-lcm-7.0.202.rpm</a></li>
<li><a href="#vxrail-systemzip">vxrail-system.zip</a></li>
<li><a href="#vxrail_70200-17911444zip">VXRAIL_7.0.200-17911444.zip</a></li>
</ul>
</li>
<li><a href="#inspecting-vib-files">Inspecting VIB files</a></li>
<li><a href="#inspecting-java-class-files">Inspecting Java Class Files</a></li>
<li><a href="#upgrades">Upgrades</a><ul>
<li><a href="#how-upgrades-work">How Upgrades Work</a></li>
<li><a href="#failed-upgrade">Failed Upgrade</a></li>
<li><a href="#observed-errors">Observed Errors</a></li>
<li><a href="#fix-action">Fix Action</a></li>
<li><a href="#understanding-upgrades-in-esxi">Understanding Upgrades in ESXi</a></li>
<li><a href="#understanding-the-vxrail-update-bundle">Understanding the VxRail Update Bundle</a></li>
<li><a href="#manifest-file-and-update-order">Manifest File and Update Order</a></li>
</ul>
</li>
<li><a href="#adding-nodes">Adding Nodes</a><ul>
<li><a href="#troubleshooting">Troubleshooting</a></li>
<li><a href="#how-adding-nodes-works-during-cluster-construction">How Adding Nodes Works During Cluster Construction</a></li>
</ul>
</li>
<li><a href="#disappearing-browse-button">Disappearing Browse Button</a></li>
<li><a href="#log-info">Log Info</a></li>
<li><a href="#fixing-half-upgrade">Fixing Half Upgrade</a></li>
<li><a href="#vcenter-logs">vCenter Logs</a></li>
<li><a href="#altbootbank">Altbootbank</a></li>
<li><a href="#add-nodes-nic-config-page">Add nodes NIC config page</a></li>
<li><a href="#add-node-error">Add Node Error</a></li>
<li><a href="#error-node">Error Node</a></li>
<li><a href="#general-error">General Error</a></li>
<li><a href="#redeploying-vxrail-manager">Redeploying VxRail Manager</a></li>
<li><a href="#logs">Logs</a><ul>
<li><a href="#generating-logs">Generating Logs</a></li>
<li><a href="#vxrail-microservice-container-logs">VxRail Microservice (container) Logs</a></li>
<li><a href="#rasr-process">RASR Process</a></li>
<li><a href="#tomcat-logs">Tomcat Logs</a></li>
<li><a href="#upgrade-logs">Upgrade Logs</a></li>
<li><a href="#api-logs">API Logs</a></li>
</ul>
</li>
<li><a href="#helpful-commands">Helpful Commands</a></li>
<li><a href="#helpful-kb-articles">Helpful KB Articles</a></li>
<li><a href="#vxrail-api-info">VxRail API Info</a></li>
</ul>
<h2 id="vxrail-architecture">VxRail Architecture</h2>
<p>Most meaningful information on VxRail can be gleaned by reverse engineering the update package. There are three files in the update package of particular interest:</p>
<ul>
<li><code>bundles/vxrail-mystic-lcm-7.0.202.rpm</code></li>
<li><code>vxrail-system.zip</code></li>
<li><code>VXRAIL_7.0.200-17911444.zip</code></li>
</ul>
<h3 id="vxrail-mystic-lcm-70202rpm">vxrail-mystic-lcm-7.0.202.rpm</h3>
<p>The mystic LCM process governs all upgrades. Any code related to the upgrade seems to be part of this process. RPMs are just archives and you can unarchive this file with 7-zip and take a look at its contents for any debugging desired.</p>
<h3 id="vxrail-systemzip">vxrail-system.zip</h3>
<p>Defines all the baselines available in JSON format.</p>
<h3 id="vxrail_70200-17911444zip">VXRAIL_7.0.200-17911444.zip</h3>
<p>This file contains all the files for VxRail that aren't associated with the upgrade subsystem.</p>
<h2 id="inspecting-vib-files">Inspecting VIB files</h2>
<p>There's a good chance you may want to be able to look inside VIB files. VIB files use a proprietary compression technology. You can get the type by opening the file in a hex editor and inspecting the headers:</p>
<p><img alt="" src="images/2021-07-21-13-00-41.png" /></p>
<p>On any ESXi host you can use the <code>vmtar</code> program to open these with the command: <code>vmtar -x &lt;INPUT_VMTAR_FILE&gt; -o &lt;OUTPUT&gt;.tar</code>. The output will be a regular tar file which you can then open with <code>tar xvf &lt;OUTPUT&gt;.tar</code></p>
<h2 id="inspecting-java-class-files">Inspecting Java Class Files</h2>
<p>Most of the Java I saw was contained in the vmware-marvin file or in the LCM Marvin RPM.</p>
<p>I was wrestling with the error:</p>
<pre><code>web.log: ERROR [tomcat-http--48] com.emc.mystic.manager.commons.emc.webutil.LocaleUtil LocaleUtil.getBundleMessage:198 - No en_US resource bundle for ExpansionValidation with key &lt;SERIAL_NUMBER&gt;
</code></pre>
<p>I was able to find the offending file in question at <code>VXRAIL_COMPOSITE-7.0.202-27047874_for_4.7.x\bundles\vxrail-mystic-lcm-7.0.202\vxrail-mystic-lcm-7.0.202-27047874.noarch\usr\lib\vmware-marvin\marvind\webapps\lcm\WEB-INF\lib\lcm-module-7.0.202\com\vce\lcm\emc</code> (that's post decompression of the vmware-marvin file inside the VIB).</p>
<p>I find that compressing the three core files for VxRail and searching them with grep for keywords from the error messages was pretty effective for locating what I wanted. In my case the following got me what I wanted for the above error:</p>
<pre><code>(base) grant@DESKTOP-2SV1E9O:/mnt/c/Users/grant/Downloads/VXRAIL_COMPOSITE-7.0.202-27047874_for_4.7.x/bundles/vxrail-mystic-lcm-7.0.202/vxrail-mystic-lcm-7.0.202-27047874.noarch$ grep -inr 'resource bundle' ./*
Binary file ./usr/lib/vmware-marvin/marvind/webapps/lcm/WEB-INF/lib/lcm-module-7.0.202/com/vce/lcm/emc/LocaleUtil.class matches
</code></pre>
<p>I used the program <a href="https://java-decompiler.github.io/">JD Project</a> to decompile the Java bytecode in question and it worked quite well. I was able to search the decompiled bytecode normally and find the offending function:</p>
<p><img alt="" src="images/2021-07-21-13-11-40.png" /></p>
<p>which then allowed me to determine that this error message was actually erronious and just a product of VxRail trying and failing to localize an error message related to disk validation.</p>
<h2 id="upgrades">Upgrades</h2>
<h3 id="how-upgrades-work">How Upgrades Work</h3>
<p>During the upgrade process the old VxRail manager will have its IP and hostname removed and be shutdown while the new one assumes the previous manager's hostname and IP. Upgrades are performed with the service account you configured when you built VxRail - <em>not root</em>.</p>
<h3 id="failed-upgrade">Failed Upgrade</h3>
<p>If an upgrade fails midflight this typically leaves the cluster in a state where there are two VxRail managers.  In my team's experience trying to resume the upgrade using the new VxRail manager leads to a host of issues. </p>
<h4 id="observed-errors">Observed Errors</h4>
<p>Specifically, we encountered the following errors:</p>
<pre><code>VxRail Update ran into a problem...
Please refer to KB488889 article.
Failed to upload bundle: VXRAIL_COMPOSITE-SLIM-7.0.132-26894200_for_4.7x.zip: Failure occured in executing the checker: Pre-checking the version compatibility among components. General unexpected error occurs during getting the information of firmwares.. Please refer to the KB517433 article.
Error extracting upgrade bundle 7.0.132-26894200. Failed to upload bundle. Please refer to log for details.
</code></pre>
<p><img alt="" src="images/2021-07-21-12-03-35.png" /></p>
<p>This error is covered by <a href="https://www.dell.com/support/kbdoc/en-us/000185222/dell-emc-vxrail-lcm-failed-at-error-extracting-update-bundle-7-0-132?lang=en">Dell EMC VxRail: LCM failed at Error extracting update bundle 7.0.132</a></p>
<p>We also saw:</p>
<pre><code>Failure occurred while running an upgrade for bundle VXRAIL_COMPOSITE-SLIM-7.0.132-26894200_for_4.7.x.zip. The error message [DependencyError] VIB DEL_bootbank_dcism_3.6.0.2249-DEL.700.0.0.15843807 requires esx-version &gt;= 7.0.0 but the requirement cannot be satisfied within the ImageProfile. Please refer to the log file for more details.
</code></pre>
<h4 id="fix-action">Fix Action</h4>
<p>The most reliable way to fix a stuck upgrade is to revert to the old VxRail Manager and then run the upgrade again. You can do this by shutting down the new VxRail Manager, deleting it, and then logging into the previous VxRail Manager on the console, re-IPing it, give it it's previous hostname, and then restarting the upgrade.</p>
<h3 id="understanding-upgrades-in-esxi">Understanding Upgrades in ESXi</h3>
<p>See <a href="../ESXi%20Architecture/#what-is-the-altbookbank-partition">What is the altbookbank Partition</a></p>
<h3 id="understanding-the-vxrail-update-bundle">Understanding the VxRail Update Bundle</h3>
<p>At the top level the upgrade is governed and controlled by the file <code>node-upgrade.py</code> in the root of the upgrade bundle:</p>
<p><img alt="" src="images/2021-07-21-12-51-31.png" /></p>
<p>The bundles directory has all the possible files that <em>could</em> be installed with the update. The exact files which are installed vary by system. More on that in the section <a href="#manifest-file-and-update-order">Manifest File and Update Order</a>.</p>
<h4 id="manifest-file-and-update-order">Manifest File and Update Order</h4>
<p>The manifest file defines which VIBs will be installed based on system parameters and in what order they will be installed in. For example: ESXi:</p>
<pre><code class="language-xml">&lt;Package InstallOrder=&quot;100&quot;&gt;
        &lt;ComponentType&gt;ESXi&lt;/ComponentType&gt;
        &lt;DisplayName&gt;ESXi&lt;/DisplayName&gt;
        &lt;Version&gt;7.0.2&lt;/Version&gt;
        &lt;Build&gt;17867351&lt;/Build&gt;
        &lt;File&gt;bundles/ESXi-7.0.2-ep1_17867351-34777dce-standard.zip&lt;/File&gt;
        &lt;Size&gt;393239990&lt;/Size&gt;
        &lt;HighestFormatVersionSupported&gt;11&lt;/HighestFormatVersionSupported&gt;
        &lt;UpgradeTime&gt;5&lt;/UpgradeTime&gt;
        &lt;RebootFlag&gt;True&lt;/RebootFlag&gt;
        &lt;Package InstallOrder=&quot;101&quot;&gt;
            &lt;ComponentType&gt;ESXi_No_Tools&lt;/ComponentType&gt;
            &lt;DisplayName&gt;VMware ESXi No Tools&lt;/DisplayName&gt;
            &lt;Version&gt;7.0.2&lt;/Version&gt;
            &lt;Build&gt;17867351&lt;/Build&gt;
            &lt;File&gt;bundles/ESXi-7.0.2-ep1_17867351-34777dce-upgrade-no-tools.zip&lt;/File&gt;
            &lt;Size&gt;207115430&lt;/Size&gt;
            &lt;HighestFormatVersionSupported&gt;11&lt;/HighestFormatVersionSupported&gt;
            &lt;UpgradeTime&gt;5&lt;/UpgradeTime&gt;
            &lt;RebootFlag&gt;True&lt;/RebootFlag&gt;
        &lt;/Package&gt;
        &lt;Package InstallOrder=&quot;1001&quot;&gt;
            &lt;ComponentType&gt;ESXi_VIB&lt;/ComponentType&gt;
            &lt;DisplayName&gt;Dell iSM for vSphere 7&lt;/DisplayName&gt;
            &lt;Version&gt;3.6.0.2249&lt;/Version&gt;
            &lt;Build&gt;DEL.700.0.0.15843807&lt;/Build&gt;
            &lt;SystemName&gt;dcism&lt;/SystemName&gt;
</code></pre>
<p>This is parsed by the function _parse_esxi_patch, _parse_install_vib, and _parse_update_firmware in node-upgrade.py on line 1381, 1454, and 1492:</p>
<pre><code class="language-python">def _parse_esxi_patch(self, element):
    task = {
        'type': &quot;esxi_patch&quot;,
        'name': &quot;Install ESXi VMware patch&quot;,
        'async': False,
        'visible': True,
    }

    task['install_order'] = int(element.get('InstallOrder'))
    task['args'] = self._extract_args(element, [
        'ComponentType',
        'DisplayName',
        'Version',
        'Build',
        'File',
        'Size',
        'HighestFormatVersionSupported',
    ])

    return task
</code></pre>
<p>---SNIP---</p>
<pre><code class="language-python">def _parse_install_vib(self, element):
  task = {
      'type': &quot;install_vib&quot;,
      'async': False,
      'visible': True,
      'package_type': 'vib',
  }

  task['name'] = &quot;Install %s&quot; % element.find('DisplayName').text
  task['install_order'] = int(element.get('InstallOrder'))
  task['args'] = self._extract_args(element, [
      'ComponentType',
      'DisplayName',
      'Version',
      'Build',
      'SystemName',
      'File',
      'Size',
      'ReplaceTargetInfo/ReplaceTarget/SystemName',
  ])

  component_type = task['args'].get('ComponentType', '')
  display_name = task['args'].get('DisplayName', '')
  if equals_ignore_case(display_name, 'VxRail VIB') or \
          equals_ignore_case(component_type, 'VXRAIL_'):
      task['args']['SystemName'] = &quot;vmware-marvin&quot;

  pkg_file = task['args'].get('File', '')
  file_path = os.path.join(self._bundle_dir, pkg_file)
  vlcm_bundle_info = self._vlcm_bundle_info(file_path)

  if vlcm_bundle_info:
      task['package_type'] = 'component'
      task['component_name'] = vlcm_bundle_info[0]
      task['component_version'] = vlcm_bundle_info[1]

  return task

def _parse_update_firmware(self, element):
  task = {
      'type': &quot;update_firmware&quot;,
      'async': True,
      'visible': True,
      'runtime_check': False,
  }

  task['name'] = &quot;Update %s&quot; % element.find('DisplayName').text
  task['install_order'] = int(element.get('InstallOrder'))
  task['args'] = self._extract_args(element, [
      'ComponentType',
      'DisplayName',
      'Version',
      'Build',
      'File',
      'Size',
  ])

  nic_models = self._extract_target_models(element, 'TargetNicModelInfo')
  component_models = self._extract_target_models(
      element, 'TargetComponentModelInfo')
  fw_models = nic_models + component_models
  if fw_models:
      task['args']['FirmwareModels'] = fw_models
  else:
      task['args']['FirmwareModels'] = None

  return task
</code></pre>
<p>These functions are used to create tasks which are stored in the <code>required_tasks</code> variable:</p>
<p><img alt="" src="images/2021-07-14-23-21-59.png" /></p>
<p>After all tasks are added to required tasks they are sorted with a lambda function on line 1898:</p>
<pre><code class="language-python">required_tasks.sort(key=lambda t: t['install_order'])
</code></pre>
<p>Subsequently it is safe to assume a linear sort on the integer value. We can use this to diagnose any problems we encounter with install order.</p>
<h2 id="adding-nodes">Adding Nodes</h2>
<p>Version Compatibility Matrix: <a href="https://l.facebook.com/l.php?u=https%3A%2F%2Fdl.dell.com%2Fcontent%2Fdocu92203_VxRail-Appliance-Node-Addition-Matrix.pdf%3Flanguage%3Den_US%26fbclid%3DIwAR3j6urHXGnMESuZB-Ptw82UDigmtZ_eBK0fyrl5EZktQltBad0EOPgnw84&amp;h=AT0viMyq6Pd30CzaVIwDwCY4faDLoX9G6d2_HN7yhG9HTdmTfB2WLwj_1kLJdCvcmSxvl2c260QgfG-bZKLkQ1pZ7oggRHzgFrypM8X5ZeA9NARg6zpIWuqk2cB4mFwXdz4">Link</a></p>
<p>Make sure before you try to do anything with adding nodes that you verify the versions are mutually compatible.</p>
<h3 id="troubleshooting">Troubleshooting</h3>
<p>We bumped into several errors while attempting to add nodes and they varied in type. One of the errors we encountered was when adding the node the interface for the VxRail plugin failed entirely. We were able to fix it with the following process:</p>
<ol>
<li>Take a snapshot of VxM</li>
<li><code>psql -U postgres vxrail -c "DELETE FROM system.operation_status WHERE state='IN_PROGRESS';"</code></li>
<li>enable advanced mode by changing it in /var/lib/vmware-marvin/lcm_advanced_mode.properties</li>
<li>Change the contents of /var/lib/vmware-mariv to <code>{"state":"NONE","vc_plugin_updated":false,"deployed_for_public_api":false}</code></li>
<li>Restart Marvin with <code>system restart vmware-marvin</code></li>
</ol>
<p>In one instance we were able to clear all problems by restarting all nodes in the cluster, the VxRail manager, and vCenter. After a full reboot of everything, a series of general errors we had been receiving during validation cleared.</p>
<h3 id="how-adding-nodes-works-during-cluster-construction">How Adding Nodes Works During Cluster Construction</h3>
<p>All nodes after being RASR have a fully built vSAN disk group. During the initial cluster construction VxRail will select a primary node and then add it to the cluster. On every subsequent node it will delete that node's vSAN disk group and then add it to the cluster's existing disk group.</p>
<h2 id="disappearing-browse-button">Disappearing Browse Button</h2>
<ol>
<li>Take a snapshot of VxM</li>
<li>psql -U postgres vxrail -c "DELETE FROM system.operation_status WHERE state='IN_PROGRESS';"</li>
<li>enable advanced mode by change it in /var/lib/vmware-marvin/lcm_advanced_mode.properties</li>
<li>Change the contents of /var/lib/vmware-mariv to {"state":"NONE","vc_plugin_updated":false,"deployed_for_public_api":false}</li>
<li>Result <code>system restart vmware-marvin</code></li>
</ol>
<h2 id="log-info">Log Info</h2>
<p>lcm-web.log - Shows upgrade related info
web.log - combined web output</p>
<h2 id="fixing-half-upgrade">Fixing Half Upgrade</h2>
<p>Roll back to previous VxRail manager, then use it to complete the upgrade.</p>
<p>Uses ESXi management account for updates
Uses PSC log</p>
<h2 id="vcenter-logs">vCenter Logs</h2>
<h2 id="altbootbank">Altbootbank</h2>
<p>You can load the old version with shift+r</p>
<h2 id="add-nodes-nic-config-page">Add nodes NIC config page</h2>
<p>When you hit https://<host>/ui/vxrail/rest/vxm/private/system/cluster-hosts?$$objectID=urn:vmomi:ClusterComputeResource:domain<ID>&amp;lang=en-us you should get back the existing hosts in the cluster with their hostname, model, serial_number, and vmnics</p>
<p>https://<HOST>/ui/vxrail/rest/vxm/private/system/available-hosts?$filter=serial_number%20in%20(SERIAL,SERIAL)&amp;$$objectId=urn:vmomi:ClusterComputeResource:domain-<ID>&amp;lang=en-us should get you the two hosts you are going to add</p>
<h2 id="add-node-error">Add Node Error</h2>
<p>"Could not find NSX-T network information"
Http failure response for https://<address>/ui/vxrail/rest/vxm/private/cluster/network/nsxt???objectId=urn:vmomi:ClusterComputeResource:domain-ID=en-US: 404 OK</p>
<h2 id="error-node">Error Node</h2>
<p>Validation Errors</p>
<p>Disk Grouping Error (JKSLH63)
Error occurs when validating disk group on host JKSLH63</p>
<p>web.log: ERROR [tomcat-http--48] com.emc.mystic.manager.commons.emc.webutil.LocaleUtil LocaleUtil.getBundleMessage:198 - No en_US resource bundle for ExpansionValidation with key JKSLH63</p>
<h2 id="general-error">General Error</h2>
<p>web.log: [WARN] com.vce.commons.config.ConfigServiceImpl$NotFoundHandler ConfigServiceImpl$NotFoundHandler.handleNotFound:114 - provided key is not present: [404, {"message":"404 Not Found: bandwidth_throttling_level does not exist"}]</p>
<h2 id="redeploying-vxrail-manager">Redeploying VxRail Manager</h2>
<p>If VxRail Manager was previously deployed but something happened to it you can rebuild it. If you have the old VxRail manager, but the cluster has changed on ESXi, you will have to do:</p>
<ul>
<li>Update <code>/var/lib/vmware-marvin/runtime.properties</code> with the new cluster UUID</li>
<li>Connect to the postgresql database on the manager, go to the settings table and update it with the new settings.</li>
</ul>
<h2 id="logs">Logs</h2>
<h3 id="generating-logs">Generating Logs</h3>
<p>If you want to get a full dump of all the logs associated with VxRail you can generate a dump by going to the VxRail plugin on vCenter, navigating to the support tab, and then clicking the generate log button.</p>
<h3 id="vxrail-microservice-container-logs">VxRail Microservice (container) Logs</h3>
<p>/var/log/microservice/vxrail-manager</p>
<h3 id="rasr-process">RASR Process</h3>
<p>The totality of the RASR process' output is stored in the images folder on the local datastore in fist.log.</p>
<h3 id="tomcat-logs">Tomcat Logs</h3>
<p>/var/log/marvin/tomcat/logs
/var/log/mystic/web.log</p>
<h3 id="upgrade-logs">Upgrade Logs</h3>
<p>The LCM process handles upgrades.</p>
<p>It's logs are all in /var/log/mystic/lcm*.</p>
<p>You can also try checking the PSC log (haven't personally done this)</p>
<h3 id="api-logs">API Logs</h3>
<p>These are on vCenter.</p>
<p>See <a href="../VMWare%20APIs/#log-locations">VMWARE API Logs</a></p>
<h2 id="helpful-commands">Helpful Commands</h2>
<p>See <a href="../Setup%20VXRail/#helpful-commands">Helpful Commands</a></p>
<h2 id="helpful-kb-articles">Helpful KB Articles</h2>
<ul>
<li>https://www.dell.com/support/kbdoc/en-uk/000021742/dell-emc-vxrail-troubleshooting-guide-for-vxrail-micro-services-infrastructure</li>
<li>https://www.dell.com/support/kbdoc/en-uk/000157667/dell-emc-vxrail-how-to-query-vxrail-cluster-configuration-data-in-7-0-010-or-higher</li>
<li>https://www.dell.com/support/kbdoc/en-us/000157715/dell-emc-vxrail-troubleshooting-guide-for-upgrading-vxrail-manager-to-7-0-010-or-higher</li>
<li>https://www.dell.com/support/kbdoc/en-us/000157662/dell-emc-vxrail-how-to-get-or-update-management-account-in-vxrail-7-0-010-or-higher</li>
<li>https://www.dell.com/support/kbdoc/en-us/000181759/dell-emc-vxrail-upgrading-vxrail-manager-to-7-0-x-release-failed-vcenter-plugin-no-loading</li>
<li>https://www.dell.com/support/kbdoc/en-us/000181712/dell-emc-vxrail-how-to-update-vxrail-manager-without-lcm</li>
</ul>
<h2 id="vxrail-api-info">VxRail API Info</h2>
<p>See <a href="../VMWare%20APIs/">VMWare APIs</a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../Web%20Traffic%20Generator/" class="btn btn-neutral float-right" title="Web Traffic Generator">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../VMWare%20APIs/" class="btn btn-neutral" title="VMWare APIs"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../VMWare%20APIs/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../Web%20Traffic%20Generator/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
