<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Grant Curell" /><link rel="canonical" href="https://grantcurell.github.io/VMWare/Setup%20VXRail/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>VxRail Setup - Grant Curell's Dell Projects</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "VxRail Setup";
        var mkdocs_page_input_path = "VMWare\\Setup VXRail\\README.md";
        var mkdocs_page_url = "/VMWare/Setup%20VXRail/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Grant Curell's Dell Projects
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Grant Curell's Dell Projects</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Adding%20Hashing%20to%20OpenSwitch/">Adding Hashing to OpenSwitch</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Adding%20Intel%20I219-LM%20%288086.0d4c%29%20Driver%20to%20ESXi/">Adding Intel I219-LM (8086.0d4c) Driver to ESXi</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Automating%20OME%20Hardware%20Reports/">Automating OME Hardware Reports</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../CloudLink/">CloudLink</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Configure%20FN410%20as%20a%20Switch/">Configure FN410 as a Switch</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Configure%20Gigamon%20Tap/">Configure Gigamon Tap</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Configuring%20VLT%20on%20OS10/">Configuring VLT on OS10</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Create%20Kickstart%20Server%20on%20Fedora/">Create Kickstart Server on Fedora</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Create%20OpenSwitch%20VM/">Create OpenSwitch VM</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Dell%20Ansible%20Testing/">Dell Ansible Testing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../DHCP%20Relay%20on%20SONiC/">DHCP Relay on SONiC</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Elasticsearch%20Display%20Map%20Data/">Elasticsearch Display Map Data</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Elasticsearch%20Load%20Testing/">Elasticsearch Load Testing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../esrally%20%28INCOMPLETE%29/">esrally (INCOMPLETE)</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Get%20NVMe%20Drives%20from%20iDRAC%20Redfish/">Get NVMe Drives from iDRAC Redfish</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../High%20Speed%20Packet%20Capture/">High Speed Packet Capture</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../How%20OS10%20Installer%20Works/">How OS10 Installer Works</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../How%20to%20ONIE%20Install%20and%20ZTP%20Config%20Dell%20SONiC/">How to ONIE Install and ZTP Config Dell SONiC</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../How%20to%20Read%20lstopo%20and%20a%20PCIe%20Overview/">How to Read lstopo and a PCIe Overview</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../idrac%20with%20LDAP/">idrac with LDAP</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Importing%20Elasticsearch%20Data/">Importing Elasticsearch Data</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Installing%20DPDK%20with%20NapaTech%20Card/">Installing DPDK with NapaTech Card</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../IO%20Identities%20with%20LifeCycle%20Controller/">IO Identities with LifeCycle Controller</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../LDAP%20with%20OpenManage/">LDAP with OpenManage</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Load%20Balance%20Testing%20on%204112F-ON/OpenSwitch%20%28OPX%29/">Load Balancing with LAG OPX</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Load%20Balance%20Testing%20on%204112F-ON/OS10/">Load Balance Testing on 4112F-ON w/OS10</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Load%20Balance%20Testing%20with%20OpenVSwitch/">Load Balance Testing with OpenVSwitch</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Load%20Balancing%20on%20Mellanox%20Switches/">Load Balancing on Mellanox Switches</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Load%20Balancing%20with%20LAG%20on%205112F-ON/">Load Balancing with LAG on 5112F-ON</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Make%20USB%20Read%20Only/">Make USB Read Only</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Migrating%20Storage%20Volumes%20to%20PowerStore/">Migrating Storage Volumes to PowerStore</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Mulitple%20Span%20on%204112F-ON%20with%20OpenSwitch/">Mulitple Span on 4112F-ON with OpenSwitch</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Multiple%20Span%20on%204112F-ON%20with%20OS10/">Multiple Span on 4112F-ON with OS10</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Notes%20on%20HPC/">Notes on HPC</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Notes%20on%20Improving%20Drive%20Performance/">Notes on Improving Drive Performance</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Notes%20on%20mdraid%20Performance%20Testing/">Notes on mdraid Performance Testing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Notes%20on%20NVMe%20Log%20Pages/">Notes on NVMe Log Pages</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Notes%20on%20PCIe/">Notes on PCIe</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Nvidia%20GPUDirect/">Nvidia GPUDirect</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Nvidia%20GRID%20Notes/">Nvidia GRID Notes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../NVMe%20Performance%20Testing/">NVMe Performance Testing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Offline%20Updates%20with%20OpenManage%20Enterprise/">Offline Updates with OpenManage Enterprise</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../OME%20Bug/">OME Bug</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../OME%20Integration%20for%20VMWare/">OME Integration for VMWare</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../OpenFlow%20on%204112F-ON/">OpenFlow on 4112F-ON</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../OS10%20Password%20Recovery%20Bug/">OS10 Password Recovery Bug</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../PCIev3%20vs%20v4/">PCIev3 vs v4</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Playing%20with%20virsh/">Playing with virsh</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Reset%20OS10%20Admin%20Password/">Reset OS10 Admin Password</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Run%20VPN%20on%20OS10/">Run VPN on OS10</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Running%20DNS%20from%20OS10/">Running DNS from OS10</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Set%20Up%20RSPAN%20on%20OS10/">Set Up RSPAN on OS10</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Setting%20Up%20Breakout%20Cables/">Setting Up Breakout Cables</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Setting%20Up%20iDRAC%20Telemetry%20with%20Splunk/">Setting Up iDRAC Telemetry with Splunk</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Setting%20Up%20SmartFabric%20Director/">Setting Up SmartFabric Director</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Setup%20IDPA/">Setup IDPA</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Site%20to%20Site%20VPN%20with%20PFSense%20and%20CentOS%208/">Site to Site VPN with PFSense and CentOS 8</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../SONiC%20-%20Sample%20Datacenter%20Automation%20Architecture/">SONiC - Sample Datacenter Automation Architecture</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Switch%20Directly%20to%20Client%20Test/">Switch Directly to Client Test</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Testing%20Intel%20x520%20on%20RHEL%206/">Testing Intel x520 on RHEL 6</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Understanding%20Memory/">Understanding Memory</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Use%20OS10%20as%20Aggregator/">Use OS10 as Aggregator</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Using%20the%20iDRAC%20Service%20Module/">Using the iDRAC Service Module</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../VEP%20Testing/">VEP Testing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Automate%20ESXi%20Installation/">Automating ESXi Installation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../ESXi%20Architecture/">VMWare Architecture Notes</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">VxRail Setup</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#license-keys">License Keys</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#networking">Networking</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#what-does-mld-querying-do-and-why-can-it-break-vxrail-discovery">What does MLD Querying Do and Why Can it Break VxRail Discovery</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#rasr-process">RASR Process</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#deploy-witness">Deploy Witness</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#after-deploying-the-witness">After deploying the Witness:</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#set-up-vcenter">Set Up vCenter</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#set-up-the-manager-for-discovery">Set up the Manager for Discovery</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#install">Install</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#advanced-troubleshooting">Advanced Troubleshooting</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#check-for-esxi-logs">Check for ESXi Logs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#marvin-logs">Marvin Logs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#digging-through-vxrails-guts">Digging Through VxRail's Guts</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#helpful-commands">Helpful Commands</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#check-if-vxrail-is-running">Check if VxRail is Running</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#get-a-list-of-vms">Get a List of VMs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#check-if-vm-is-on">Check if VM is On</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#check-networking">Check Networking</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#set-the-vlan-for-a-switch">Set the VLAN for a Switch</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#get-interface-ips">Get Interface IPs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#get-interface-list">Get Interface List</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Troubleshooting%20vSAN/">Troubleshooting vSAN</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../VMWare%20APIs/">VMWare APIs</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../VxRail%20Architecture%20and%20Troubleshooting/">VxRail Architecture and Troubleshooting</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Change%20User%20on%20VxRail%20Plugin/">Change User on VxRail Plugin</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Web%20Traffic%20Generator/">Web Traffic Generator</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Grant Curell's Dell Projects</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li><li>VxRail Setup</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="vxrail-setup">VxRail Setup</h1>
<ul>
<li><a href="#vxrail-setup">VxRail Setup</a></li>
<li><a href="#license-keys">License Keys</a></li>
<li><a href="#networking">Networking</a><ul>
<li><a href="#what-does-mld-querying-do-and-why-can-it-break-vxrail-discovery">What does MLD Querying Do and Why Can it Break VxRail Discovery</a></li>
</ul>
</li>
<li><a href="#rasr-process">RASR Process</a></li>
<li><a href="#deploy-witness">Deploy Witness</a><ul>
<li><a href="#after-deploying-the-witness">After deploying the Witness:</a></li>
</ul>
</li>
<li><a href="#set-up-vcenter">Set Up vCenter</a></li>
<li><a href="#set-up-the-manager-for-discovery">Set up the Manager for Discovery</a></li>
<li><a href="#install">Install</a></li>
<li><a href="#advanced-troubleshooting">Advanced Troubleshooting</a><ul>
<li><a href="#check-for-esxi-logs">Check for ESXi Logs</a></li>
<li><a href="#marvin-logs">Marvin Logs</a></li>
<li><a href="#digging-through-vxrails-guts">Digging Through VxRail's Guts</a></li>
</ul>
</li>
<li><a href="#helpful-commands">Helpful Commands</a><ul>
<li><a href="#check-if-vxrail-is-running">Check if VxRail is Running</a></li>
<li><a href="#get-a-list-of-vms">Get a List of VMs</a></li>
<li><a href="#check-if-vm-is-on">Check if VM is On</a></li>
<li><a href="#check-networking">Check Networking</a></li>
<li><a href="#set-the-vlan-for-a-switch">Set the VLAN for a Switch</a></li>
<li><a href="#get-interface-ips">Get Interface IPs</a></li>
<li><a href="#get-interface-list">Get Interface List</a></li>
</ul>
</li>
</ul>
<h2 id="license-keys">License Keys</h2>
<p>In case you have to upgrade or downgrade license keys see <a href="https://kb.vmware.com/s/article/81665">this KB article</a></p>
<h2 id="networking">Networking</h2>
<p>I followed <a href="https://www.delltechnologies.com/it-it/collaterals/unauth/technical-guides-support-information/products/converged-infrastructure/h15300-vxrail-network-guide.pdf">the VxRail Network Planning Guide</a> to set up the network.</p>
<p><strong>WARNING</strong>: The discovery process for VxRail uses IPv6 multicast to discover itself. Dell switches come with MLD snooping globally enabled, but <strong>do not</strong> have the MLD querier enabled! This will cause the nodes to flap! Servers will discover themselves and then disappear. You must enable MLD snooping <strong>and</strong> the mld querier on the correct vlans with <code>interface vlan #</code> and then <code>ipv6 mld snooping querier</code>.</p>
<h3 id="what-does-mld-querying-do-and-why-can-it-break-vxrail-discovery">What does MLD Querying Do and Why Can it Break VxRail Discovery</h3>
<p>By default, switches are not multicast aware so they will broadcast any multicast traffic on all ports assigned to a VLAN.</p>
<p>For bandwidth optimization the switch will block any multicast messages to a segment it thinks does not have a device which wants those multicast messages. It discovers if there is an interested host by using MLD general queries or group specific queries. Enabling the querier will allow the switch to use these messages to discover interested hosts and subsequently ensure those hosts receive the appropriate IPv6 messages.</p>
<h2 id="rasr-process">RASR Process</h2>
<p>There is an IDSDM module on the box with the factor image on the box. To perform the RASR process you'll boot from that and it will copy over all necessary files to the internal BOSS drive. Just follow the prompts.</p>
<p><strong>WARNING</strong> RASRing a node blows away absolutely everything on all drives! <strong>DO NOT RUN ON A PRODUCTION CLUSTER</strong></p>
<h2 id="deploy-witness">Deploy Witness</h2>
<p><em>Note</em> For the two node setup, you will need a third site with vCenter deployed in a cluster separate from VxRail.</p>
<p><strong>WARNING</strong> If someone tells you that 1 proc, 16GB R240 is sufficient for running the Witness and vCenter in a 2 node setup... that is strictly speaking true. Do not plan on putting anything else on that box.</p>
<p>Download the witness appliance from <a href="https://my.vmware.com/web/vmware/downloads/details?downloadGroup=WITNESS-OVA-67&amp;productId=742">the VMWare site</a>. <strong>Make sure you pull the witness appliance for your setup!</strong> On VxRail 4.7 which is what I'm installing the correct version of Witness is 6.7.</p>
<p>Follow the instructions <a href="https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.vsan-planning.doc/GUID-05C1737A-5FBA-4AEE-BDB8-3BF5DE569E0A.html">here</a> for setup. The only thing that could be confusing depending on what you've previously read is that the second NIC for the Witness goes on its own special VLAN separate from VSAN. This VLAN will be used only for Witness traffic.</p>
<p><strong>Point of Curiosity</strong> The Witness host looks exactly like an instance of ESXi because it is. It's only purpose is to pretend to be a third ESXi host and avoid split brain on vSAN.</p>
<h3 id="after-deploying-the-witness">After deploying the Witness:</h3>
<ol>
<li>Give vmk0 an IP on your management network and vmk1 an IP address on the vSAN network. You can use the <code>esxcli network ip interface ipv4 set -i vmk0 --type static -I 192.168.5.130 -N 255.255.255.0 -g 192.168.5.1</code> command to IP an interface</li>
<li>Go into vCenter and add the Witness</li>
<li>Make sure vmk0 of the Witness has the same MAC address of vmk0 on the host OR set the security settings of the management portgroup you are using to promiscuous</li>
</ol>
<h2 id="set-up-vcenter">Set Up vCenter</h2>
<ol>
<li>Make sure your DNS server can resolve all the VxRail ESXi IPs first before continuing.</li>
<li>On vCenter double check that DNS and NTP are setup correctly. You can do this from the network menu by going to Home-&gt;Administration-&gt;System Configuration-&gt;Click on vCenter-&gt;Login. This should bring up the appliance management screen. Check Time and Networking.</li>
<li>vCenter has to be able to resolve all ESXi names itself. <strong>This is not checked by VxRail's validator</strong>! To double check name resolution, go to vCenter's console, hit alt+F1, use nslookup to check all the ESXi node names.</li>
</ol>
<h2 id="set-up-the-manager-for-discovery">Set up the Manager for Discovery</h2>
<ul>
<li><a href="https://davidring.ie/2019/06/10/vxrail-4-7-install-notes/">David Ring's Install Notes</a> are helpful</li>
<li>
<p><a href="https://davidring.ie/2019/11/13/vxrail-4-7-ipv6-node-discovery-test/">David Ring's notes</a> on how host discovery works are also helpful</p>
<pre><code>Loudmouth requires IPv6 multicast in order for VxRail Manager to perform a successful VxRail node discovery. IPv6 multicast is required only on the ‘Private Management Network’, this is an isolated management network solely for auto-discovery of the VxRail nodes during install or expansion. The default VLAN ID for the private network is 3939, which is configured on each VxRail node from the factory, this VLAN needs to be configured on the TOR switches and remains isolated on the TORs. If you wish to deviate from the default of VLAN 3939 then each node will need to be modified onsite otherwise node discovery will fail.
</code></pre>
<ul>
<li>The VxRail Manager comes defaulted to 192.168.10.200 however, it does not accept SSH connections</li>
</ul>
</li>
<li>
<p>Turn on the VxRail manager. <code>vxrail-primary --setup --vxrail-address 192.168.2.100  --vxrail-netmask 255.255.255.0 --vxrail-gateway 192.168.2.1</code>. The IP you assign is <strong>not</strong> used for discovery. It is for reaching the VxRail appliance. Give it an IP on whatever network/vlan you plan on using for management. Details below in step 3.
      1.Make sure vmk0 of all ESXi hosts is on VLAN 3939 or whatever VLAN you're using for discovery.
      2.On each ESXi host make sure <em>Private Management Network</em> and <em>Private VM Network</em> are both on VLAN 3939. (Picture from David Ring's guide)</p>
<p><img alt="" src="images/2020-12-15-13-42-40.png" /></p>
<p>3.The VxRail manager has two virtual NICs - eth0 and eth1. Eth1 is the NIC used for discovery. Make sure eth1 of the VxRail manager is on VLAN 3939. The first NIC (eth0) should be on whatever VLAN you are using for management. You will get to the VxRail manager webgui through eth0.
2. At this point you should have full IPv6 connectivity between vmk0 on all ESXi instances and the VxRail appliance. You can test this with the following:
  1.Go to the ESXi console, press ALT+F1 and Pull the IPv6 address for vmk0 on ESXi with: <code>esxcfg-vmknic -l | grep vmk0</code>
  2.On the ESXi host with the VxRail appliance, give another (not vmk0) VM kernel NIC you have access to an IP address with the <code>esxcli network ip interface ipv4 set -i vmk0 --type static -I 192.168.5.130 -N 255.255.255.0 -g 192.168.5.1</code> command. For dhcp use the <code>--type dhcp</code> option. See <a href="#helpful-commands">Helpful Commands</a> for how to list out the different portgroups and VMs
  3.Once you know all the IPv6 addresses for the various vmk0 nics, get on the VxRail appliance and use <code>ping6 -l eth1 &lt;ipv6 address&gt;</code> to test your IPv6 ping. This should work against all devices. If it doesn't you probably have a networking problem.
  4.You can also test the full server discovery process manually from the command line with:</p>
<p><img alt="" src="images/2020-12-16-09-13-40.png" /></p>
<p>5.On the switch side you can use <code>show lldp discovery</code> to see what interfaces it has discovered and it will list the interfaces.
  6.On idrac it will show you what ports each nic is connected to under network devices. (My example is down - yours should not have a warning)</p>
<p><img alt="" src="images/2020-12-17-08-52-14.png" /></p>
<p>7.For further troubleshooting check the Marvin log
3. Assuming you've already checked DNS, the last thing you need to do is make sure NTP is up. I'm using chrony and checked like this on my NTP server:</p>
<pre><code>[root@services ~]# chronyc tracking
Reference ID    : D8EF230C (time4.google.com)
Stratum         : 2
Ref time (UTC)  : Thu Dec 17 16:21:48 2020
System time     : 0.000059723 seconds fast of NTP time
Last offset     : +0.000004093 seconds
RMS offset      : 0.000036436 seconds
Frequency       : 0.283 ppm fast
Residual freq   : -0.000 ppm
Skew            : 0.006 ppm
Root delay      : 0.023636952 seconds
Root dispersion : 0.001011974 seconds
Update interval : 1037.1 seconds
Leap status     : Normal
</code></pre>
</li>
</ul>
<h2 id="install">Install</h2>
<p>Before running I strongly recommend you make sure NTP is up and running on any customer owned ESXi instances, customer vCenters, and the idracs. Mismatched time causes problems.</p>
<p>All you have to do is browse to your VxRail Manager's address on follow the prompts. The only <strong>big</strong> gotcha I ran into is when it asks for vCenter Server Management Username what it wants is <strong>not</strong> administrator@vphere.whatever. It wants vCenter's root/password combo.</p>
<h2 id="advanced-troubleshooting">Advanced Troubleshooting</h2>
<h3 id="check-for-esxi-logs">Check for ESXi Logs</h3>
<p>In my case I hit a failure where a node wouldn't add. A lot of times VxRail will have finished the ESXi deployment and you can actually go log into the ESXi instance in question. If you have a customer owned vCenter you can also go check its logs. A lot of the time failures during deployment can be found in one of those locations.</p>
<h3 id="marvin-logs">Marvin Logs</h3>
<p>Another good place to look is to log into the VxRail appliance and check the Marvin logs at <code>/var/log/vmware/marvin/tomcat</code></p>
<h3 id="digging-through-vxrails-guts">Digging Through VxRail's Guts</h3>
<p>If you have problems during install you can pull VxRail's logs from the VxRail container by doing the below:</p>
<p>Run <code>docker ps -a</code> and find the vxrail-system container.</p>
<pre><code>e8da567768e4        infra/openfaas/gateway:1.1.4               &quot;./gateway&quot;              2 days ago          Up 2 days (healthy)     8080/tcp, 8082/tcp    func_gateway.1.h5hmx70g8545d3apbwfxtfatr
2b71bfd81e90        infra/openfaas/queue-worker:1.1.4          &quot;./app&quot;                  2 days ago          Up 2 days (healthy)     8080/tcp              func_queue-worker.1.897j8f0tbhas1989o0ygl5ez4
ba2f65a96664        infra/workflow_engine:1.1.6                &quot;./docker-entrypoint…&quot;   2 days ago          Up 2 days (healthy)     5000/tcp              func_wfservice.1.wau7b1omhg3igjzzyvd865r6e
d07929b37e2d        infra/openfaas/gateway:1.1.4               &quot;./gateway&quot;              2 days ago          Exited (1) 2 days ago                         func_gateway.1.stdin4eg1dysl3fajgpds5rwj
e6f3ec734f8a        infra/openfaas/queue-worker:1.1.4          &quot;./app&quot;                  2 days ago          Exited (2) 2 days ago                         func_queue-worker.1.uqy8d482650v4yquz98fnp9tq
bc402e3b676c        microservice/vxm-agent:1.1.6               &quot;/bin/bash entrypoin…&quot;   2 days ago          Up 2 days (healthy)     5000/tcp              vxm-agent_vxm-agent_1
23e0ac7d3f92        microservice/nano-service:1.1.29           &quot;python -u index.py&quot;     2 days ago          Up 2 days (healthy)     5000/tcp              func_nano-service.1.dqo23zdkgmwbqf9ru6yn0t99r
54df5cb0af13        microservice/ms-day1-bringup:1.1.29        &quot;/bin/bash entrypoin…&quot;   2 days ago          Up 2 days (healthy)     5000/tcp              func_ms-day1-bringup.1.xfe0xndtvsqbo17kapogyd7ke
87e26e7d27b2        infra/infra-lock-service:1.1.8             &quot;/bin/bash entrypoin…&quot;   2 days ago          Up 2 days (healthy)     5000/tcp              func_lockservice.1.g2g7hg5viyph8r4ptcljeran9
4382600d0094        microservice/lockbox:1.1.11                &quot;/bin/bash entrypoin…&quot;   2 days ago          Up 2 days (healthy)     5000/tcp              func_lockbox.1.q9hqbfuid54r5gelsazasksh2
f7964475a933        microservice/kgs-service:1.1.10            &quot;./boot.sh&quot;              2 days ago          Up 2 days (healthy)     5000/tcp              func_kgs-service.1.wpqm7hytpf5l9wo7ch3sc1wz7
75178ef078ea        do-main/do-vxrail-system:1.1.35            &quot;/bin/bash entrypoin…&quot;   2 days ago          Up 2 days (healthy)     5000/tcp              func_do-vxrail-system.1.e67dbhktpe88gw0wtmymmpthg
7abeddce2bb8        do-main/do-vm:1.1.35                       &quot;/bin/bash entrypoin…&quot;   2 days ago          Up 2 days (healthy)     5000/tcp              func_do-vm.1.g2fwikfzimyhv6di3zdalt1j3
3b557989c07e        do-main/do-storage:1.1.35                  &quot;/bin/bash entrypoin…&quot;   2 days ago          Up 2 days (healthy)     5000/tcp              func_do-storage.1.w2nv1rfpidrv7g418xmknywso
d0b15759e7f5        do-main/do-serviceability:1.1.35           &quot;/bin/bash entrypoin…&quot;   2 days ago          Up 2 days (healthy)                           func_do-serviceability.1.t5xkwt1eu2ypqvn0511i1gfy3
5e349b22f36a        do-main/do-network:1.1.39                  &quot;/bin/bash entrypoin…&quot;   2 days ago          Up 2 days (healthy)     5000/tcp              func_do-network.1.vogoz7jtyrxf83h9jd0615r28
ae31c7cd94bd        do-main/do-kgs:1.1.35                      &quot;./boot.sh&quot;              2 days ago          Up 2 days (healthy)     5000/tcp              func_do-kgs.1.esudf6d39uy7e96dnvxoabaue
978447c9f6f8        do-main/do-host:1.1.39                     &quot;/bin/bash entrypoin…&quot;   2 days ago          Up 2 days (healthy)     5000/tcp              func_do-host.1.ravl83nt962k48up0v33qoviy
862926a58073        do-main/do-ecosystem:1.1.35                &quot;/bin/bash entrypoin…&quot;   2 days ago          Up 2 days (healthy)                           func_do-ecosystem.1.8k6cljhvo5p00632gt11f79uv
63dde78fc922        do-main/do-eservices:1.1.35                &quot;/bin/bash entrypoin…&quot;   2 days ago          Up 2 days (healthy)                           func_do-eservices.1.pnpnr1pofm0dvwv36trufl6g9
f1fb1d35457d        do-main/do-cluster:1.1.35                  &quot;/bin/bash entrypoin…&quot;   2 days ago          Up 2 days (healthy)     5000/tcp              func_do-cluster.1.y4vs2diiyy5eau3ojuxdx12wx
2fc837e0726e        infra/infra-config-service:1.1.9           &quot;/bin/bash entrypoin…&quot;   2 days ago          Up 2 days (healthy)     5000/tcp              func_configservice.1.byjhptdpdxa3d04y7mr5lfp5z
685d833e0155        infra/openfaas/gateway:1.1.4               &quot;./gateway&quot;              2 days ago          Exited (1) 2 days ago                         func_gateway.1.ztar1zozhfuh3skopwvlandwq
9af0891d5455        infra/openfaas/queue-worker:1.1.4          &quot;./app&quot;                  2 days ago          Exited (2) 2 days ago                         func_queue-worker.1.jmk9q8bkc6a2vlz3fg1e60y5f
0cb6d7948db9        infra/tracing:1.1.6                        &quot;/go/bin/jaeger-all-…&quot;   2 days ago          Up 2 days (healthy)                           func_tracing.1.ymsjr3ba7ih2x21291xri4mz8
5e70fa63df88        infra/openfaas/faas-swarm:1.1.4            &quot;./faas-swarm&quot;           2 days ago          Up 2 days (healthy)     8080/tcp              func_faas-swarm.1.nfz0dm48hhx7vh9sh04mbagtz
620cce221e65        infra/nats-streaming:1.1.4                 &quot;/nats-streaming-ser…&quot;   2 days ago          Up 2 days (healthy)     4222/tcp, 8222/tcp    func_nats.1.l42vx07v08vhhtkv1lwxg1ipb
dd16298b3e4c        infra/nginx_gateway_vxrail:1.1.7           &quot;/bin/sh -c 'sudo /u…&quot;   2 days ago          Up 2 days (healthy)                           func_api-gateway.1.do9gzerxmmlti4rn8k3ab2gs4
4a8b6c976103        infra/gcr.io/etcd-development/etcd:1.1.4   &quot;/usr/local/bin/etcd…&quot;   2 days ago          Up 2 days (healthy)     2379-2380/tcp         func_serviceregistry.1.u2gtw5wnsldulqgd1r47wkte5
acf803b61b04        infra/redis:1.1.4                          &quot;docker-entrypoint.s…&quot;   2 days ago          Up 2 days (healthy)     6379/tcp              func_cacheservice.1.subywzigvenobaskavjs6xyqc
3dac923f9bff        infra/logging:1.1.4                        &quot;tini -- /bin/entryp…&quot;   2 days ago          Up 2 days (healthy)     5140/tcp, 24224/tcp   func_logging.1.kv7738umixulwryqpl38qvxvr
bdd88fadc236        infra/prom/alertmanager:1.1.4              &quot;/bin/alertmanager -…&quot;   2 days ago          Up 2 days (healthy)     9093/tcp              func_alertmanager.1.8uks430a7p10keeh8uqv625bv
7ec04254fee1        infra/prom/prometheus:1.1.4                &quot;/bin/prometheus --c…&quot;   2 days ago          Up 2 days (healthy)     9090/tcp              func_prometheus.1.ti36b3wsder4w01v8nentdirx

</code></pre>
<p>Find the log location with <code>docker inspect --format='{{.LogPath}}' 75178ef078ea</code>. They are in JSON format. For example, this is what my error looked like:</p>
<p>This got me the reason for my failure:</p>
<pre><code class="language-json">{\\\&quot;error\\\&quot;: {\\\&quot;result\\\&quot;: {\\\&quot;error\\\&quot;: {\\\&quot;code\\\&quot;: \\\&quot;E3100_Cluster_22\\\&quot;, \\\&quot;message\\\&quot;: \\\&quot;failed to add host into cluster\\\&quot;, \\\&quot;params\\\&quot;: [\\\&quot;vxrail1-esxi.lan\\\&quot;]}}}, \\\&quot;id\\\&quot;: \\\&quot;host_add_into_inventory\\\&quot;, \\\&quot;internal_family\\\&quot;: \\\&quot;node_one_bootstrap_with_cns_ready.primary_node_computer.host_add_into_inventory\\\&quot;, \\\&quot;internal_id\\\&quot;: \\\&quot;node_one_bootstrap_with_cns_ready.primary_node_computer.host_add_into_inventory_False____99ee8388_1147_4e_9d65c98cb2\\\&quot;, &quot;,
  &quot;stream&quot;: &quot;stderr&quot;,
  &quot;time&quot;: &quot;2020-12-18T13:24:42.028798775Z&quot;
}

{&quot;log&quot;:&quot;\\\&quot;params\\\&quot;: {\\\&quot;cluster_name\\\&quot;: \\\&quot;vxrail-cluster\\\&quot;, \\\&quot;datacenter_name\\\&quot;: \\\&quot;Datacenter\\\&quot;, \\\&quot;host_conn_info\\\&quot;: {\\\&quot;host\\\&quot;: \\\&quot;192.168.2.31\\\&quot;, \\\&quot;port\\\&quot;: 443, \\\&quot;username\\\&quot;: \\\&quot;root\\\&quot;}, \\\&quot;hostname\\\&quot;: \\\&quot;vxrail1-esxi.lan\\\&quot;, \\\&quot;ssl_thumbprint\\\&quot;: \\\&quot;STUFF\\\&quot;, \\\&quot;vc_conn_info\\\&quot;: {\\\&quot;host\\\&quot;: \\\&quot;vcenter.lan\\\&quot;, \\\&quot;port\\\&quot;: 443, \\\&quot;username\\\&quot;: \\\&quot;administrator@vsphere.lan\\\&quot;}, \\\&quot;vm_folder_name\\\&quot;: \\\&quot;VMware HCIA Folder vxrail-cluster\\\&quot;, \\\&quot;vsan_name\\\&quot;: \\\&quot;VxRail-Virtual-SAN-Datastore-22658cd0-5b17-428d-a23c-0d7e5a877bb7\\\&quot;}, \\\&quot;stage\\\&quot;: \\\&quot;primary_node_computer\\\&quot;, \\\&quot;startTime\\\&quot;: 1608297822107, \\\&quot;status\\\&quot;: \\\&quot;FAILED\\\&quot;}
</code></pre>
<h2 id="helpful-commands">Helpful Commands</h2>
<h3 id="check-if-vxrail-is-running">Check if VxRail is Running</h3>
<p><code>esxcli vm process list</code></p>
<h3 id="get-a-list-of-vms">Get a List of VMs</h3>
<p><code>vim-cmd vmsvc/getallvms</code></p>
<h3 id="check-if-vm-is-on">Check if VM is On</h3>
<p><code>vim-cmd vmsvc/power.getstate 1</code></p>
<h3 id="check-networking">Check Networking</h3>
<p><code>esxcli network vswitch standard portgroup list</code></p>
<h3 id="set-the-vlan-for-a-switch">Set the VLAN for a Switch</h3>
<p><code>esxcli network vswitch standard portgroup set -p "VM Network" -v 120</code></p>
<h3 id="get-interface-ips">Get Interface IPs</h3>
<p><code>esxcli network ip interface ipv4 get</code></p>
<h3 id="get-interface-list">Get Interface List</h3>
<p><code>esxcli network ip interface list</code></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../ESXi%20Architecture/" class="btn btn-neutral float-left" title="VMWare Architecture Notes"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../Troubleshooting%20vSAN/" class="btn btn-neutral float-right" title="Troubleshooting vSAN">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../ESXi%20Architecture/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../Troubleshooting%20vSAN/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
