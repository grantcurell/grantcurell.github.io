<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Grant Curell" /><link rel="canonical" href="https://grantcurell.github.io/Adding%20Hashing%20to%20OpenSwitch/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Adding Hashing to OpenSwitch - Grant Curell's Dell Projects</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Adding Hashing to OpenSwitch";
        var mkdocs_page_input_path = "Adding Hashing to OpenSwitch/README.md";
        var mkdocs_page_url = "/Adding%20Hashing%20to%20OpenSwitch/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Grant Curell's Dell Projects
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Grant Curell's Dell Projects</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Adding Hashing to OpenSwitch</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#installing-header-files-for-opx-base">Installing header files for OPX base</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#adding-space-remote-desktop">Adding Space / Remote Desktop</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#configure-usb">Configure USB</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#extend-partition">Extend Partition</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#remote-desktop">Remote Desktop</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#on-centos-7">On CentOS 7</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#set-up-vm">Set Up VM</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#failed-but-should-have-worked">Failed, but should have worked</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#building-from-source">Building from source</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#build-an-installer">Build an installer</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#investigation-into-the-opx-config-global-switch-problem">Investigation into the opx-config-global-switch problem</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#investigation-2-compilation-problems">Investigation 2 - Compilation problems</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#investigation-3-post-compilation-value-still-missing">Investigation 3 - post compilation value still missing</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#investigation-4-where-are-the-hash-values">Investigation 4 - Where are the hash values?</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#some-related-resources">Some related resources</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#descriptions">Descriptions</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#nas">NAS</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Adding%20Intel%20I219-LM%20%288086.0d4c%29%20Driver%20to%20ESXi/">Adding Intel I219-LM (8086.0d4c) Driver to ESXi</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Automatically%20Provision%20Dell%20Servers/">Automatically Provision Dell Servers</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Automating%20OME%20Hardware%20Reports/">Automating OME Hardware Reports</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Backup%20OS10%20Config%20with%20Ansible/">Backup OS10 Config with Ansible</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../CloudLink/">CloudLink</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Common%20Questions%20About%20LLMs%20Answered/">Common Questions About LLMs Answered</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Configure%20FN410%20as%20a%20Switch/">Configure FN410 as a Switch</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Configure%20Gigamon%20Tap/">Configure Gigamon Tap</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Configuring%20VLT%20on%20OS10/">Configuring VLT on OS10</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Create%20Kickstart%20Server%20on%20Fedora/">Create Kickstart Server on Fedora</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Create%20OpenSwitch%20VM/">Create OpenSwitch VM</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../DHCP%20Relay%20on%20SONiC/">DHCP Relay on SONiC</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Dell%20Ansible%20Testing/">Dell Ansible Testing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Elasticsearch%20Display%20Map%20Data/">Elasticsearch Display Map Data</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Elasticsearch%20Load%20Testing/">Elasticsearch Load Testing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Estimating%20Compute%20Requirements%20for%20Machine%20Learning/">Estimating Compute Requirements for Machine Learning</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Finding%20Rare%20Logs%20with%20DBSCAN/">Finding Rare Logs with DBSCAN</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Get%20NVMe%20Drives%20from%20iDRAC%20Redfish/">Get NVMe Drives from iDRAC Redfish</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../High%20Speed%20Packet%20Capture/">High Speed Packet Capture</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../How%20Bitcoin-Blockchain%20Works%20-%20Notes/">How Bitcoin-Blockchain Works - Notes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../How%20OS10%20Installer%20Works/">How OS10 Installer Works</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../How%20to%20ONIE%20Install%20and%20ZTP%20Config%20Dell%20SONiC/">How to ONIE Install and ZTP Config Dell SONiC</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../How%20to%20Read%20lstopo%20and%20a%20PCIe%20Overview/">How to Read lstopo and a PCIe Overview</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../IO%20Identities%20with%20LifeCycle%20Controller/">IO Identities with LifeCycle Controller</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Importing%20Elasticsearch%20Data/">Importing Elasticsearch Data</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Installing%20DPDK%20with%20NapaTech%20Card/">Installing DPDK with NapaTech Card</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../LDAP%20with%20OpenManage/">LDAP with OpenManage</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../LLMs%20Explained/">LLMs Explained</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Load%20Balance%20Testing%20with%20OpenVSwitch/">Load Balance Testing with OpenVSwitch</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Load%20Balancing%20on%20Mellanox%20Switches/">Load Balancing on Mellanox Switches</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Load%20Balancing%20with%20LAG%20on%205112F-ON/">Load Balancing with LAG on 5112F-ON</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Make%20USB%20Read%20Only/">Make USB Read Only</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Migrating%20Storage%20Volumes%20to%20PowerStore/">Migrating Storage Volumes to PowerStore</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Mulitple%20Span%20on%204112F-ON%20with%20OpenSwitch/">Mulitple Span on 4112F-ON with OpenSwitch</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Multiple%20Span%20on%204112F-ON%20with%20OS10/">Multiple Span on 4112F-ON with OS10</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../NVMe%20Performance%20Testing/">NVMe Performance Testing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Notes%20on%20AMD%20Processor/">Notes on AMD Processor</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Notes%20on%20Building%20a%20Datacenter%20from%20Scratch/">Notes on Building a Datacenter from Scratch</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Notes%20on%20HPC/">Notes on HPC</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Notes%20on%20HSM/">Notes on HSM</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Notes%20on%20Improving%20Drive%20Performance/">Notes on Improving Drive Performance</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Notes%20on%20NVMe%20Log%20Pages/">Notes on NVMe Log Pages</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Notes%20on%20PCIe/">Notes on PCIe</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Notes%20on%20mdraid%20Performance%20Testing/">Notes on mdraid Performance Testing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Notes%20on%20nodejs/">Notes on nodejs</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Nvidia%20GPUDirect/">Nvidia GPUDirect</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Nvidia%20GRID%20Notes/">Nvidia GRID Notes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../OME%20Bug/">OME Bug</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../OME%20Integration%20for%20VMWare/">OME Integration for VMWare</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../OS10%20Password%20Recovery%20Bug/">OS10 Password Recovery Bug</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Offline%20Updates%20with%20OpenManage%20Enterprise/">Offline Updates with OpenManage Enterprise</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../OpenFlow%20on%204112F-ON/">OpenFlow on 4112F-ON</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../PCIev3%20vs%20v4/">PCIev3 vs v4</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Playing%20with%20virsh/">Playing with virsh</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../PowerScale%20-%20Configure%20with%20Kubernetes/">PowerScale - Configure with Kubernetes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../PowerScale%20Failed%20Authentication/">PowerScale Failed Authentication</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../PowerScale%20Setup/">PowerScale Setup</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Reset%20OS10%20Admin%20Password/">Reset OS10 Admin Password</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Run%20VPN%20on%20OS10/">Run VPN on OS10</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Running%20DNS%20from%20OS10/">Running DNS from OS10</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../SONiC%20-%20Sample%20Datacenter%20Automation%20Architecture/">SONiC - Sample Datacenter Automation Architecture</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Set%20Up%20RSPAN%20on%20OS10/">Set Up RSPAN on OS10</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Setting%20Up%20Breakout%20Cables/">Setting Up Breakout Cables</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Setting%20Up%20SmartFabric%20Director/">Setting Up SmartFabric Director</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Setting%20Up%20iDRAC%20Telemetry%20with%20Splunk/">Setting Up iDRAC Telemetry with Splunk</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Setup%20IDPA/">Setup IDPA</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Site%20to%20Site%20VPN%20with%20PFSense%20and%20CentOS%208/">Site to Site VPN with PFSense and CentOS 8</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Switch%20Directly%20to%20Client%20Test/">Switch Directly to Client Test</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Testing%20Bare%20Metal%20Orchestrator/">Testing Bare Metal Orchestrator</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Testing%20Intel%20x520%20on%20RHEL%206/">Testing Intel x520 on RHEL 6</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Understanding%20Memory/">Understanding Memory</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Understanding%20PERC%20Interrupts/">Understanding PERC Interrupts</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Use%20OS10%20as%20Aggregator/">Use OS10 as Aggregator</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Using%20FIO/">Using FIO</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Using%20the%20iDRAC%20Service%20Module/">Using the iDRAC Service Module</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../VEP%20Testing/">VEP Testing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Web%20Traffic%20Generator/">Web Traffic Generator</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Writing%20udev%20Rules%20for%20Dell%20PERC%20H755/">Writing udev Rules for Dell PERC H755</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../esrally%20%28INCOMPLETE%29/">esrally (INCOMPLETE)</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../idrac%20with%20LDAP/">idrac with LDAP</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Load%20Balance%20Testing%20on%204112F-ON/OS10/">Load Balance Testing on 4112F-ON w/OS10</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Load%20Balance%20Testing%20on%204112F-ON/OpenSwitch%20%28OPX%29/">Load Balancing with LAG OPX</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../VMWare/Automate%20ESXi%20Installation/">Automating ESXi Installation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../VMWare/Change%20User%20on%20VxRail%20Plugin/">Change User on VxRail Plugin</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../VMWare/ESXi%20Architecture/">VMWare Architecture Notes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../VMWare/How%20to%20Pull%20Usage%20Metrics/">How to Pull Usage Metrics</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../VMWare/Notes%20on%20VSAN/">Notes on vSAN</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../VMWare/Setup%20VXRail/">VxRail Setup</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../VMWare/Troubleshooting%20vSAN/">Troubleshooting vSAN</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../VMWare/VMWare%20APIs/">VMWare APIs</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../VMWare/VxRail%20Architecture%20and%20Troubleshooting/">VxRail Architecture and Troubleshooting</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../VMWare/vRealize%20Setup%20%28Incomplete%29/">Setting Up vRealize</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Grant Curell's Dell Projects</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Adding Hashing to OpenSwitch</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="adding-hashing-to-openswitch">Adding Hashing to OpenSwitch</h1>
<p>This is the first problem: https://github.com/open-switch/opx-tools/issues/27</p>
<p>He says the code should be somewhere here: https://github.com/open-switch/opx-base-model/blob/master/yang-models/dell-base-hash.yang</p>
<p><img alt="https://github.com/open-switch/opx-docs/wiki/NAS-L2" src="images/nas_l2.png" /></p>
<p><img alt="https://github.com/open-switch/opx-docs/raw/master/images/opx_architecture.png" src="images/opx_architecture.png" /></p>
<p><a href="https://github.com/open-switch/opx-base-model">Helpful docs on how yang is processed</a></p>
<p><a href="https://lists.openswitch.net/g/dev/topic/24228194?p=Created,,,20,2,0,0::recentpostdate%2Fsticky,,,20,2,0,24228194">Helpful forum communication about header files</a></p>
<h2 id="installing-header-files-for-opx-base">Installing header files for OPX base</h2>
<p>Run <code>apt install -y libopx-base-model-dev</code>. The headers will be in <code>/usr/include/opx</code>. The metadata files are in <code>ls /usr/lib/x86_64-linux-gnu/</code></p>
<h2 id="adding-space-remote-desktop">Adding Space / Remote Desktop</h2>
<p>I wanted more space on my installation so I added a usb drive. Do the following
to clear the USB driver and then add space:</p>
<h3 id="configure-usb">Configure USB</h3>
<pre><code>fdisk /dev/sdb
d
d
d
w
</code></pre>
<h3 id="extend-partition">Extend Partition</h3>
<pre><code>pvcreate /deb/sdb
vgextend OPX /dev/sdb
lvextend -l +100%FREE /dev/OPX/SYSROOT1
resize2fs /dev/mapper/OPX-SYSROOT1
</code></pre>
<h3 id="remote-desktop">Remote Desktop</h3>
<pre><code>sudo apt update
sudo apt install xfce4 xfce4-goodies xorg dbus-x11 x11-xserver-utils
sudo apt install xrdp
sudo adduser xrdp ssl-cert 
xfce4-session-logout --halt
</code></pre>
<h4 id="on-centos-7">On CentOS 7</h4>
<pre><code>yum install -y epel-release
yum groupinstall -y "Xfce"
echo "xfce4-session" &gt; ~/.Xclients
chmod a+x ~/.Xclients
</code></pre>
<h2 id="set-up-vm">Set Up VM</h2>
<h3 id="failed-but-should-have-worked">Failed, but should have worked</h3>
<p>wget http://archive.openswitch.net/vm-tools/lvm
chmod +x lvm
wget https://dell-networking.bintray.com/opx-images/opx-onie-installer_1.1_amd64.bin
wget https://dell-networking.bintray.com/opx-images/onie-kvm_x86_64-r0.iso
wget https://archive.openswitch.net/installers/3.2.1/Dell-EMC/PKGS_OPX-3.2.1-installer-x86_64.bin
./lvm create openswitch --iso onie-kvm_x86_64-r0.iso --bin PKGS_OPX-3.2.1-installer-x86_64.bin</p>
<h3 id="building-from-source">Building from source</h3>
<p><a href="https://github.com/opencomputeproject/onie/tree/master/contrib/build-env">Docs</a></p>
<pre><code>git clone https://github.com/opencomputeproject/onie.git
cd onie/contrib/build-env/
docker build -t debian:build-env .
mkdir --mode=0777 -p opt/src
docker run -it -v /opt/src:/home/build/src --privileged --name onie debian:build-env
</code></pre>
<p>In the container:</p>
<p>./clone-onie
cd src/onie/build-config
make -j4 MACHINE=kvm_x86_64 all</p>
<h2 id="build-an-installer">Build an installer</h2>
<p>See available distrubitions: <code>opx-build/scripts/opx_run opx_rel_pkgasm.py --help</code></p>
<p>After running a build you can run <code>opx-build/scripts/opx_run opx_rel_pkgasm.py --dist unstable -b opx-onie-installer/release_bp/OPX_dell_base.xml</code> to build an installer</p>
<p>This looks like it should be the docker build command <code>docker run --rm --name root_root_32994 --privileged -e LOCAL_UID=0 -e LOCAL_GID=0 -v /root:/mnt -v /root/.gitconfig:/home/opx/.gitconfig -v /etc/localtime:/etc/localtime:ro -e ARCH -e DIST -e OPX_RELEASE -e OPX_GIT_TAG -e CUSTOM_SOURCES opxhub/build:latest</code></p>
<h2 id="investigation-into-the-opx-config-global-switch-problem">Investigation into the opx-config-global-switch problem</h2>
<ul>
<li>cps_get_oid.py -qua target base-switch/switching-entities/switching-entity</li>
<li>The question to ask is - what is the server application for the CPS object?</li>
<li>The problem is that in <code>opx-config-global-switch</code> the value <code>lag-hash-fields</code> isn't present in target_attrs  on line 214 of opx-config-global-switch</li>
<li>The question is what would populate that?</li>
<li>I don't think any of what I care about is in NAS L2.</li>
<li>NAS L2 handles This repository contains the Layer 2 (L2) component of the network abstraction service (NAS). This handles media access control (MAC) learning, programming spanning-tree protocol (STP) state, mirroring, sFlow, and other switch configurations.</li>
<li>I think what I care about is in opx-nas-interface because the operating system is handling the LAG. Description is</li>
<li>This repository contains the interface portion of the network abstraction service (NAS). This creates interfaces in the Linux kernel corresponding to the network processor unit (NPU) front panel ports, manages VLAN and LAG configurations, statistics management and control packet handling.</li>
<li>Logically there are three components including the LAG: LAG DS, NAS LAG, NDI LAG. See picture.</li>
<li>NAS Daemon: The NAS daemon integrates standard Linux network APIs with NPU hardware functionality, and registers and listens to networking (netlink) events.</li>
<li>What enum values in the model of dell-base-hash align with what's in opx-config-global-switch in hash fields map.</li>
<li>What are all these actions in opx-config-global-switch?</li>
<li>Ok - so now we know the thing I want is in base-traffic-hash/entry, but <code>opx-config-global-switch</code> is looking at <code>base-switch/switching-entities/switching-entity</code>. The next question is what populates that? Why are the hashes not in it?<ul>
<li>The definition for switching-entity is at: https://github.com/open-switch/opx-base-model/blob/abdf66f813b48a3c8e7682361cdacccd0271866d/yang-models/dell-base-switch-element.yang</li>
<li>Say what? <code>hash-fields</code> is also defined in <code>base-switch/switching-entities/switching-entity</code></li>
</ul>
</li>
<li>The next question to ask is who has ownership of base-traffic-hash? What about base-switch/switching-entities/switching-entity? The problem seems like it should be there? Why? </li>
<li>base-traffic-hash is owned by opx_nas_daemon</li>
<li>base-switch/switching-entities/switching-entity is also owned by opx_nas_daemon</li>
<li>CPS has a REST service according to: https://github.com/open-switch/opx-cps</li>
<li>The connection between YANG and the applications seems to be the CPS API? </li>
<li>Applications define objects through (optionally YANG-based) object models. These object models are converted into binary (C accessible) object keys and object attributes that can be used in conjunction with the C-based CPS APIs.</li>
<li>Description of cps_model_info: This tool is useful to get all information about CPS objects on the target. It is used to get the attributes of a specific CPS object, or first-level contents of a given YANG path of the CPS object (as defined in the YANG model).</li>
<li>IT GIVES THE PROCESS OWNER!</li>
<li>Investigating ops-nas-daemon</li>
<li>There is a file called base_nas_default_init which defines the mirror port and the flow behaviors. I haven't found anything about other stuff yet.<ul>
<li><code>opx-config-global-switch --lag-hash-alg crc</code> works and is owned by opx_nas_daemon - there must be other things it owns beside this.</li>
<li>There is a file called <code>hald_init.c</code>. I think what is happening is all the other services fall under the NAS daemon. The code I'm looking for is somewhere else.</li>
<li>After following that around for a while it looks like the file I'm really interested in is here <code>https://github.com/open-switch/opx-nas-l2/blob/7e80d3952786f219b8072f1666ff1f16ba353d86/src/switch/nas_hash_cps.cpp</code>. This bubbles up to the L2 init function, which bubbles back up to <code>hald_init.c</code>.<ul>
<li><code>dell-base-hash.h</code> gets included in this thing.</li>
</ul>
</li>
</ul>
</li>
<li>The YANG for the regular hash algorithm is at https://github.com/open-switch/opx-base-model/blob/abdf66f813b48a3c8e7682361cdacccd0271866d/yang-models/dell-base-switch-element.yang</li>
<li>Initial investigation finished opened: https://github.com/open-switch/opx-nas-l2/issues/34</li>
</ul>
<h2 id="investigation-2-compilation-problems">Investigation 2 - Compilation problems</h2>
<ul>
<li>https://android.googlesource.com/platform/hardware/broadcom/wlan/+/master/bcmdhd/config/config-bcm.mk - examlpe config-bcm file. Seems to have something to do with broadcom's config.</li>
<li>Better example configuration from Broadcom: http://broadcom-switch.github.io/OpenNSL/doc/html/OPENNSL_CUSTOMIZING_OPENNSL.html#OPENNSL_CONFIG_EXAMPLE</li>
<li>Configuration properties: http://broadcom-switch.github.io/OpenNSL/doc/html/OPENNSL_CUSTOMIZING_OPENNSL.html#OPENNSL_CONFIG_PROPERTIES</li>
<li>More info on config.bcm https://docs.broadcom.com/doc/12378910</li>
</ul>
<h2 id="investigation-3-post-compilation-value-still-missing">Investigation 3 - post compilation value still missing</h2>
<ul>
<li>The hash variables seem to be passed by pointer from nas_hash_cps.cpp to nas_ndi_hash.c in line 222.</li>
<li>The SAI portion of the hash creation seems to be here which could prove helpful later.</li>
<li>In the bug at https://github.com/open-switch/opx-tools/issues/27 where he says <code>obj-type</code> that is referring to the YANG model. There is a leaf called <code>obj-type</code>.</li>
<li>
<p>Traffic refers to:</p>
<pre><code>typedef traffic {
    type enumeration {
        enum "ECMP_NON_IP" {
            value 1;
    description "ECMP routing: flow of non-IP ethernet frames";
        }
        enum "LAG_NON_IP" {
            value 2;
    description "LAG routing: flow of non-IP ethernet frames";
        }
        enum "ECMP_IPV4" {
            value 3;
    description "ECMP routing: flow of IPv4 packets";
        }
        enum "ECMP_IPV4_IN_IPV4" {
            value 4;
    description "ECMP routing: flow of IPv4 packets with
                            IPv4 packets tunnelled inside them";
        }
        enum "ECMP_IPV6" {
            value 5;
    description "ECMP routing: flow of IPv6 packets";
        }
        enum "LAG_IPV4" {
            value 6;
    description "LAG routing: flow of IPv4 packets";
        }
        enum "LAG_IPV4_IN_IPV4" {
            value 7;
    description "ECMP routing: flow of IPv4 packets with
                            IPv4 packets tunnelled inside them";
        }
        enum "LAG_IPV6" {
            value 8;
    description "LAG routing: traffic flow is identified as IPv6 packets";
        }
    }
    description "Enumeration of different types of traffic routing categories";
}
</code></pre>
<ul>
<li>
<p><code>std-hash-field</code> is a leaf-list with a type of <code>field</code>. <code>field</code> is defined as:</p>
<p>typedef field {
    type enumeration {
        enum "src-ip" {
            value 1;
            description "Traffic flow is identified by the source IP";
        }
        enum "dest-ip" {
            value 2;
            description "Traffic flow is identified by the destination IP";
        }
        enum "inner-src-ip" {
            value 3;
            description "Traffic flow is identified by the source IP of the tunnelled packet";
        }
        enum "inner-dst-ip" {
            value 4;
            description "Traffic flow is identified by the destination IP of the tunnelled packet";
        }
        enum "vlan-id" {
            value 5;
            description "Traffic flow is identified by the VLAN ID in the packet";
        }
        enum "ip-protocol" {
            value 6;
            description "Traffic flow is identified by the IP protocol type(v4/v6)";
        }
        enum "ethertype" {
            value 7;
            description "Traffic flow is identified by the IP protocol ether-type";
        }
        enum "l4-src-port" {
            value 8;
            description "Traffic flow is identified by the source port in the packet";
        }
        enum "l4-dest-port" {
            value 9;
            description "Traffic flow is identified by the destination port in the packet";
        }
        enum "src-mac" {
            value 10;
            description "Traffic flow is identified by the source MAC address";
        }
        enum "dest-mac" {
            value 11;
            description "Traffic flow is identified by the destination MAC address";
        }
        enum "in-port" {
            value 12;
            description "Traffic flow is identified by the front-panel port the packet is received at";
        }
    }
    description "Enumeration of different types of packet fields to check for routing";
}
- <code>cps_get</code> definition:</p>
</li>
</ul>
<p>def cps_get(q, obj, attrs={}):
    resp = []
    return resp if cps.get([cps_object.CPSObject(obj,
                                                qual=q,
                                                data=attrs
                                            ).get()
                        ], resp
    ) else None</p>
<p>def cps_set(obj, qual, data):
return (cps_utils.CPSTransaction([('set',
            cps_object.CPSObject(obj, qual=qual, data=data).get())]).commit()
        )
- <code>cps_set('base-pas/led', 'target', {'entity-type': 3, 'slot': 1, 'name': 'Beacon', 'on': args.state})</code>
- Set syntax: <code>root@OPX:~# cps_set_oid.py -qua target -oper set -attr base-switch/entry/std-hash-field=1,2,8,9,6,5 base-switch/entry base-switch/entry/obj-type=6</code>
- cps_get python syntax: <code>cps_get('target', 'base-traffic-hash/entry', {'base-traffic-hash/entry/obj-type': '2'})</code>. That would get the object <code>target</code> from qualifier  <code>base-switch/entry</code> which has attribute of <code>base-switch/entry/obj-type</code> (which is the key in entry) and we specifically want key 1 which is a type of traffic correspeonding to <code>ECMP_NON_IP</code></p>
</li>
</ul>
<blockquote>
<blockquote>
<p>pp.pprint(cps_get('target', 'base-traffic-hash/entry', {'base-traffic-hash/entry/obj-type': '6'}))
  [   {   'data': {   'base-traffic-hash/entry/std-hash-field': [   bytearray(b'\x01\x00\x00\x00'),
                                                                    bytearray(b'\x02\x00\x00\x00'),
                                                                    bytearray(b'\x08\x00\x00\x00'),
                                                                    bytearray(b'\t\x00\x00\x00'),
                                                                    bytearray(b'\x06\x00\x00\x00')]},
          'key': '1.257.16842755.16842753.16842754.'}]</p>
</blockquote>
</blockquote>
<ul>
<li>CORRECT SYNTAX FOR CPS_SET: <code>cps_set('base-traffic-hash/entry', 'target', {'base-traffic-hash/entry/obj-type': '6', 'base-traffic-hash/entry/std-hash-field': [1,2,8,9,6,5]})</code></li>
</ul>
<h2 id="investigation-4-where-are-the-hash-values">Investigation 4 - Where are the hash values?</h2>
<ul>
<li>Part of the hash seems to be set in <a href="https://github.com/open-switch/opx-nas-ndi/blob/1ba4c72309ef33d8600b18dedabc8aed2a8665ac/src/nas_ndi_switch.cpp">nas_ndi_switch.cpp</a></li>
<li>There is also a unit test for it in <a href="https://github.com/open-switch/opx-sai-common/blob/9939160482f331a0770fade523c94d607e5a70dc/src/unit_test/hash/sai_hash_unit_test.cpp">sai_hash_unit_test.cpp</a></li>
<li>
<p>This code seems to imply that the hashes themselves are implemented in the SAI:</p>
<pre><code>static _enum_map _algo_stoy  = {
    {SAI_HASH_ALGORITHM_XOR, BASE_SWITCH_HASH_ALGORITHM_XOR },
    {SAI_HASH_ALGORITHM_CRC, BASE_SWITCH_HASH_ALGORITHM_CRC },
    {SAI_HASH_ALGORITHM_RANDOM, BASE_SWITCH_HASH_ALGORITHM_RANDOM },
    {SAI_HASH_ALGORITHM_CRC_CCITT, BASE_SWITCH_HASH_ALGORITHM_CRC16CC },
    {SAI_HASH_ALGORITHM_CRC_32LO, BASE_SWITCH_HASH_ALGORITHM_CRC32LSB },
    {SAI_HASH_ALGORITHM_CRC_32HI, BASE_SWITCH_HASH_ALGORITHM_CRC32MSB },
    {SAI_HASH_ALGORITHM_CRC_XOR8, BASE_SWITCH_HASH_ALGORITHM_XOR8 },
    {SAI_HASH_ALGORITHM_CRC_XOR4, BASE_SWITCH_HASH_ALGORITHM_XOR4 },
    {SAI_HASH_ALGORITHM_CRC_XOR2, BASE_SWITCH_HASH_ALGORITHM_XOR2 },
    {SAI_HASH_ALGORITHM_CRC_XOR1, BASE_SWITCH_HASH_ALGORITHM_XOR1 },
};

static bool to_sai_type_hash_algo(sai_attribute_t *param ) {
    return to_sai_type(_algo_stoy,param);
}

static bool from_sai_type_hash_algo(sai_attribute_t *param ) {
    return from_sai_type(_algo_stoy,param);
}
</code></pre>
</li>
<li>
<p>There is a reference to each of these hash algorithms in <code>https://github.com/open-switch/opx-base-model/blob/abdf66f813b48a3c8e7682361cdacccd0271866d/history/dell-base-switch-element.yhist</code></p>
</li>
<li>
<p>From the SAI unit test I found:</p>
<pre><code>    set_attr.value.s32 = SAI_HASH_ALGORITHM_XOR;
    status = switch_api_tbl_get()-&gt;set_switch_attribute (switch_id,&amp;set_attr);
    EXPECT_EQ (SAI_STATUS_SUCCESS, status);
</code></pre>
</li>
<li>
<p>This must be where they are setting the hash algorithm and how to set it. But where is this API? How do I find out what the options are? Is symmetric hashing exposed?</p>
</li>
<li>
<p>The definition for the function is (it happens inside one of the unit tests):</p>
<pre><code>static inline sai_switch_api_t* switch_api_tbl_get (void)
{
    return p_sai_switch_api_tbl;
}
</code></pre>
<ul>
<li>This is a pointer to a table. I'm guessing it's a struct. <code>sai_switch_api_t</code> is short for SAI switch API table. It is a pointer to the table with all the API calls.</li>
<li>From <a href="https://github.com/opencomputeproject/SAI/blob/master/stub/inc/stub_sai.h">this</a> I got a hint - it looks like there is a thing called switch_api - the same name is used in OpenSwitch.</li>
<li>
<p>Based on the inputs from <a href="https://github.com/open-switch/opx-nas-ndi/blob/1ba4c72309ef33d8600b18dedabc8aed2a8665ac/src/nas_ndi_hash.c">nas_ndi_hash.c</a> there must be a series of SAI files with the functionality I want.</p>
<pre><code>#include "std_error_codes.h"
#include "std_assert.h"
#include "nas_ndi_event_logs.h"
#include "nas_ndi_utils.h"
#include "dell-base-hash.h"

#include "sai.h"
#include "saiswitch.h"
#include "saihash.h"

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;

#include &lt;inttypes.h&gt;
</code></pre>
</li>
<li></li>
</ul>
<h3 id="some-related-resources">Some related resources</h3>
<ul>
<li><a href="https://docs.cumulusnetworks.com/cumulus-linux-41/Layer-3/Equal-Cost-Multipath-Load-Sharing-Hardware-ECMP/#:~:text=setting%20symmetric_hash_enable%20%3D%20FALSE%20.-,Resilient%20Hashing,this%20can%20create%20session%20failures.">ECMP Hashing explained</a></li>
<li><a href="https://docs.broadcom.com/doc/12358326">Broadcom Paper on Hashing</a></li>
<li><a href="http://docs.openvswitch.org/en/latest/tutorials/ovs-conntrack/">Can I do this with openvswitch</a></li>
<li>This didn't pan out.</li>
<li><a href="http://broadcom-switch.github.io/OpenNSL/doc/html/pages.html">Broadcom docs</a></li>
</ul>
</li>
</ul>
<h2 id="descriptions">Descriptions</h2>
<h3 id="nas">NAS</h3>
<p>The NAS manages the high-level NPU abstraction and adaptation, and abstracts and aggregates the core functionality required for networking access at Layer 1 (physical), Layer 2 (VLAN, link aggregation), Layer 3 (routing), ACL, QoS, and network monitoring.</p>
<p>The NAS provides adaptation of the low-level switch abstraction provided by the SAI for standard Linux networking APIs and interfaces, and CPS API functionality. The NAS is also responsible for providing packet I/O services using the Linux kernel IP stack (see Network adaptation service for complete information).</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href=".." class="btn btn-neutral float-left" title="Grant Curell's Dell Projects"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../Adding%20Intel%20I219-LM%20%288086.0d4c%29%20Driver%20to%20ESXi/" class="btn btn-neutral float-right" title="Adding Intel I219-LM (8086.0d4c) Driver to ESXi">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href=".." style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../Adding%20Intel%20I219-LM%20%288086.0d4c%29%20Driver%20to%20ESXi/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
